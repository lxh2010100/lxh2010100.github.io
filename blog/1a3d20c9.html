<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="使用qemu搭建ARM64调试环境,支持文件共享,支持gdb调试, 永远在路上">
    <meta name="description" content="主机ubuntu版本: 22.04
qemu模拟处理器：ARM64
Linux内核版本：https://www.kernel.org/ 最新版
1 安装编译工具链sudo apt-get install gcc-aarch64-linux-">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>使用qemu搭建ARM64调试环境,支持文件共享,支持gdb调试 | 华仔の小站</title>
    <link rel="icon" type="image/jpeg" href="/favicon.jpeg">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="华仔の小站" type="application/atom+xml">
</head>


    <body>
        <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.jpeg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">华仔の小站</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/books" class="waves-effect waves-light">
      
      <i class="fas fa-book" style="zoom: 0.6;"></i>
      
      <span>书籍</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle-o" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-chain" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.jpeg" class="logo-img circle responsive-img">
        
        <div class="logo-name">华仔の小站</div>
        <div class="logo-desc">
            
            从来没有真正的绝境，只有心灵的迷途
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/books" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-book"></i>
			
			书籍
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle-o"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-chain"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

            



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/242.jpeg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">使用qemu搭建ARM64调试环境,支持文件共享,支持gdb调试</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Linux/">
                                <span class="chip bg-color">Linux</span>
                            </a>
                        
                            <a href="/tags/Qemu/">
                                <span class="chip bg-color">Qemu</span>
                            </a>
                        
                            <a href="/tags/kernel/">
                                <span class="chip bg-color">kernel</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Linux/" class="post-category">
                                Linux
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-03-21
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2024-02-03
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    7.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    43 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism-atom-dark.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>主机<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ubuntu&amp;spm=1001.2101.3001.7020">ubuntu</a>版本: 22.04</p>
<p>qemu模拟处理器：ARM64</p>
<p>Linux内核版本：<a target="_blank" rel="noopener" href="https://www.kernel.org/">https://www.kernel.org/</a> 最新版</p>
<h1 id="1-安装编译工具链"><a href="#1-安装编译工具链" class="headerlink" title="1 安装编译工具链"></a>1 安装编译工具链</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> gcc-aarch64-linux-gnu<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看版本号</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  ~ aarch64-linux-gnu-gcc <span class="token parameter variable">-v</span>
Using built-in specs.
<span class="token assign-left variable">COLLECT_GCC</span><span class="token operator">=</span>aarch64-linux-gnu-gcc
<span class="token assign-left variable">COLLECT_LTO_WRAPPER</span><span class="token operator">=</span>/usr/lib/gcc-cross/aarch64-linux-gnu/11/lto-wrapper
Target: aarch64-linux-gnu
Configured with: <span class="token punctuation">..</span>/src/configure <span class="token parameter variable">-v</span> --with-pkgversion<span class="token operator">=</span><span class="token string">'Ubuntu 11.2.0-17ubuntu1'</span> --with-bugurl<span class="token operator">=</span>file:///usr/share/doc/gcc-11/README.Bugs --enable-languages<span class="token operator">=</span>c,ada,c++,go,d,fortran,objc,obj-c++,m2 <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr --with-gcc-major-version-only --program-suffix<span class="token operator">=</span>-11 --enable-shared --enable-linker-build-id <span class="token parameter variable">--libexecdir</span><span class="token operator">=</span>/usr/lib --without-included-gettext --enable-threads<span class="token operator">=</span>posix <span class="token parameter variable">--libdir</span><span class="token operator">=</span>/usr/lib --enable-nls --with-sysroot<span class="token operator">=</span>/ --enable-clocale<span class="token operator">=</span>gnu --enable-libstdcxx-debug --enable-libstdcxx-time<span class="token operator">=</span>yes --with-default-libstdcxx-abi<span class="token operator">=</span>new --enable-gnu-unique-object --disable-libquadmath --disable-libquadmath-support --enable-plugin --enable-default-pie --with-system-zlib --enable-libphobos-checking<span class="token operator">=</span>release --without-target-system-zlib --enable-multiarch --enable-fix-cortex-a53-843419 --disable-werror --enable-checking<span class="token operator">=</span>release <span class="token parameter variable">--build</span><span class="token operator">=</span>x86_64-linux-gnu <span class="token parameter variable">--host</span><span class="token operator">=</span>x86_64-linux-gnu <span class="token parameter variable">--target</span><span class="token operator">=</span>aarch64-linux-gnu --program-prefix<span class="token operator">=</span>aarch64-linux-gnu- <span class="token parameter variable">--includedir</span><span class="token operator">=</span>/usr/aarch64-linux-gnu/include --with-build-config<span class="token operator">=</span>bootstrap-lto-lean --enable-link-serialization<span class="token operator">=</span><span class="token number">2</span>
Thread model: posix
Supported LTO compression algorithms: zlib zstd
gcc version <span class="token number">11.2</span>.0 <span class="token punctuation">(</span>Ubuntu <span class="token number">11.2</span>.0-17ubuntu1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="2-安装qemu"><a href="#2-安装qemu" class="headerlink" title="2 安装qemu"></a>2 安装qemu</h1><h2 id="2-1-命令行安装"><a href="#2-1-命令行安装" class="headerlink" title="2.1 命令行安装"></a>2.1 命令行安装</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> qemu-system-arm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看版本：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  ~ qemu-system-aarch64 <span class="token parameter variable">--version</span>
QEMU emulator version <span class="token number">6.2</span>.0 <span class="token punctuation">(</span>Debian <span class="token number">1</span>:6.2+dfsg-2ubuntu6.6<span class="token punctuation">)</span>
Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2003</span>-2021 Fabrice Bellard and the QEMU Project developers<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="2-2-源码安装"><a href="#2-2-源码安装" class="headerlink" title="2.2 源码安装"></a>2.2 源码安装</h2><ol>
<li>QEMU依赖库安装</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> re2c <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> ninja-build <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> build-essential zlib1g-dev pkg-config libglib2.0-dev <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> aptinstall binutils-dev libboost-all-dev autoconf libtool libssl-dev libpixman-1-dev libpython-dev python-pip python-capstone virtualenv <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> libpixman-1-dev <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> bison flex <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> meson <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> libpixman-1-dev <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libpcap-dev libnids-dev libnet1-dev <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libattr1-dev <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libcap-ng-dev <span class="token parameter variable">-y</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>下载busybox源码</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://download.qemu.org/qemu-7.2.0.tar.xz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li>解压</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> xvJf qemu-7.2.0.tar.xz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="4">
<li>配置</li>
</ol>
<p>支持配置项</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  qemu-7.2.0 ./configure <span class="token parameter variable">--help</span>
Using <span class="token string">'./build'</span> as the directory <span class="token keyword">for</span> build output

Usage: configure <span class="token punctuation">[</span>options<span class="token punctuation">]</span>
Options: <span class="token punctuation">[</span>defaults <span class="token keyword">in</span> brackets after descriptions<span class="token punctuation">]</span>

Standard options:
  <span class="token parameter variable">--help</span>                   print this message
  <span class="token parameter variable">--prefix</span><span class="token operator">=</span>PREFIX          <span class="token function">install</span> <span class="token keyword">in</span> PREFIX <span class="token punctuation">[</span>/usr/local<span class="token punctuation">]</span>
  --target-list<span class="token operator">=</span>LIST       <span class="token builtin class-name">set</span> target list <span class="token punctuation">(</span>default: build all<span class="token punctuation">)</span>
                           Available targets: aarch64-softmmu alpha-softmmu
                           arm-softmmu avr-softmmu cris-softmmu hppa-softmmu
                           i386-softmmu loongarch64-softmmu m68k-softmmu
                           microblaze-softmmu microblazeel-softmmu mips-softmmu
                           mips64-softmmu mips64el-softmmu mipsel-softmmu
                           nios2-softmmu or1k-softmmu ppc-softmmu ppc64-softmmu
                           riscv32-softmmu riscv64-softmmu rx-softmmu
                           s390x-softmmu sh4-softmmu sh4eb-softmmu
                           sparc-softmmu sparc64-softmmu tricore-softmmu
                           x86_64-softmmu xtensa-softmmu xtensaeb-softmmu
                           aarch64-linux-user aarch64_be-linux-user
                           alpha-linux-user arm-linux-user armeb-linux-user
                           cris-linux-user hexagon-linux-user hppa-linux-user
                           i386-linux-user loongarch64-linux-user
                           m68k-linux-user microblaze-linux-user
                           microblazeel-linux-user mips-linux-user
                           mips64-linux-user mips64el-linux-user
                           mipsel-linux-user mipsn32-linux-user
                           mipsn32el-linux-user nios2-linux-user
                           or1k-linux-user ppc-linux-user ppc64-linux-user
                           ppc64le-linux-user riscv32-linux-user
                           riscv64-linux-user s390x-linux-user sh4-linux-user
                           sh4eb-linux-user sparc-linux-user
                           sparc32plus-linux-user sparc64-linux-user
                           x86_64-linux-user xtensa-linux-user
                           xtensaeb-linux-user
  --target-list-exclude<span class="token operator">=</span>LIST exclude a <span class="token builtin class-name">set</span> of targets from the default target-list

Advanced options <span class="token punctuation">(</span>experts only<span class="token punctuation">)</span>:
  --cross-prefix<span class="token operator">=</span>PREFIX    use PREFIX <span class="token keyword">for</span> compile tools, PREFIX can be blank <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token parameter variable">--cc</span><span class="token operator">=</span>CC                  use C compiler CC <span class="token punctuation">[</span>cc<span class="token punctuation">]</span>
  --host-cc<span class="token operator">=</span>CC             use C compiler CC <span class="token punctuation">[</span>cc<span class="token punctuation">]</span> <span class="token keyword">for</span> code run at
                           build <span class="token function">time</span>
  <span class="token parameter variable">--cxx</span><span class="token operator">=</span>CXX                use C++ compiler CXX <span class="token punctuation">[</span>c++<span class="token punctuation">]</span>
  <span class="token parameter variable">--objcc</span><span class="token operator">=</span>OBJCC            use Objective-C compiler OBJCC <span class="token punctuation">[</span>cc<span class="token punctuation">]</span>
  --extra-cflags<span class="token operator">=</span>CFLAGS    append extra C compiler flags CFLAGS
  --extra-cxxflags<span class="token operator">=</span>CXXFLAGS append extra C++ compiler flags CXXFLAGS
  --extra-objcflags<span class="token operator">=</span>OBJCFLAGS append extra Objective C compiler flags OBJCFLAGS
  --extra-ldflags<span class="token operator">=</span>LDFLAGS  append extra linker flags LDFLAGS
  --cross-cc-ARCH<span class="token operator">=</span>CC       use compiler when building ARCH guest <span class="token builtin class-name">test</span> cases
  --cross-cc-cflags-ARCH<span class="token operator">=</span>  use compiler flags when building ARCH guest tests
  --cross-prefix-ARCH<span class="token operator">=</span>PREFIX cross compiler prefix when building ARCH guest <span class="token builtin class-name">test</span> cases
  <span class="token parameter variable">--make</span><span class="token operator">=</span>MAKE              use specified <span class="token function">make</span> <span class="token punctuation">[</span>make<span class="token punctuation">]</span>
  <span class="token parameter variable">--python</span><span class="token operator">=</span>PYTHON          use specified python <span class="token punctuation">[</span>/usr/bin/python3<span class="token punctuation">]</span>
  <span class="token parameter variable">--meson</span><span class="token operator">=</span>MESON            use specified meson <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token parameter variable">--ninja</span><span class="token operator">=</span>NINJA            use specified ninja <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token parameter variable">--smbd</span><span class="token operator">=</span>SMBD              use specified smbd <span class="token punctuation">[</span><span class="token punctuation">]</span>
  --with-git<span class="token operator">=</span>GIT           use specified <span class="token function">git</span> <span class="token punctuation">[</span>git<span class="token punctuation">]</span>
  --with-git-submodules<span class="token operator">=</span>update   update <span class="token function">git</span> submodules <span class="token punctuation">(</span>default <span class="token keyword">if</span> .git <span class="token function">dir</span> exists<span class="token punctuation">)</span>
  --with-git-submodules<span class="token operator">=</span>validate fail <span class="token keyword">if</span> <span class="token function">git</span> submodules are not up to <span class="token function">date</span>
  --with-git-submodules<span class="token operator">=</span>ignore   <span class="token keyword">do</span> not update or check <span class="token function">git</span> submodules <span class="token punctuation">(</span>default <span class="token keyword">if</span> no .git <span class="token function">dir</span><span class="token punctuation">)</span>
  <span class="token parameter variable">--static</span>                 <span class="token builtin class-name">enable</span> static build <span class="token punctuation">[</span>no<span class="token punctuation">]</span>
  <span class="token parameter variable">--bindir</span><span class="token operator">=</span><span class="token environment constant">PATH</span>            <span class="token function">install</span> binaries <span class="token keyword">in</span> <span class="token environment constant">PATH</span>
  --with-suffix<span class="token operator">=</span>SUFFIX     suffix <span class="token keyword">for</span> QEMU data inside datadir/libdir/sysconfdir/docdir <span class="token punctuation">[</span>qemu<span class="token punctuation">]</span>
  --without-default-features default all --enable-* options to <span class="token string">"disabled"</span>
  --without-default-devices  <span class="token keyword">do</span> not include any device that is not needed to
                           start the emulator <span class="token punctuation">(</span>only use <span class="token keyword">if</span> you are including
                           desired devices <span class="token keyword">in</span> configs/devices/<span class="token punctuation">)</span>
  --with-devices-ARCH<span class="token operator">=</span>NAME override default configs/devices
  --enable-debug           <span class="token builtin class-name">enable</span> common debug build options
  --enable-sanitizers      <span class="token builtin class-name">enable</span> default sanitizers
  --enable-tsan            <span class="token builtin class-name">enable</span> thread sanitizer
  --disable-werror         disable compilation abort on warning
  --disable-stack-protector disable compiler-provided stack protection
  <span class="token parameter variable">--cpu</span><span class="token operator">=</span>CPU                Build <span class="token keyword">for</span> <span class="token function">host</span> CPU <span class="token punctuation">[</span>x86_64<span class="token punctuation">]</span>
  --with-coroutine<span class="token operator">=</span>BACKEND coroutine backend. Supported options:
                           ucontext, sigaltstack, windows
  --enable-plugins
                           <span class="token builtin class-name">enable</span> plugins via shared library loading
  --disable-containers     don't use containers <span class="token keyword">for</span> cross-building
  <span class="token parameter variable">--gdb</span><span class="token operator">=</span>GDB-path           gdb to use <span class="token keyword">for</span> gdbstub tests <span class="token punctuation">[</span>/usr/bin/gdb<span class="token punctuation">]</span>
  --audio-drv-list<span class="token operator">=</span>CHOICES Set audio driver list <span class="token punctuation">[</span>default<span class="token punctuation">]</span> <span class="token punctuation">(</span>choices: alsa/co
                           reaudio/default/dsound/jack/oss/pa/sdl/sndio<span class="token punctuation">)</span>
  --block-drv-ro-whitelist<span class="token operator">=</span>VALUE
                           <span class="token builtin class-name">set</span> block driver read-only whitelist <span class="token punctuation">(</span>by default
                           affects only QEMU, not tools like qemu-img<span class="token punctuation">)</span>
  --block-drv-rw-whitelist<span class="token operator">=</span>VALUE
                           <span class="token builtin class-name">set</span> block driver read-write whitelist <span class="token punctuation">(</span>by default
                           affects only QEMU, not tools like qemu-img<span class="token punctuation">)</span>
  <span class="token parameter variable">--datadir</span><span class="token operator">=</span>VALUE          Data <span class="token function">file</span> directory <span class="token punctuation">[</span>share<span class="token punctuation">]</span>
  --disable-coroutine-pool coroutine freelist <span class="token punctuation">(</span>better performance<span class="token punctuation">)</span>
  --disable-install-blobs  <span class="token function">install</span> provided firmware blobs
  <span class="token parameter variable">--docdir</span><span class="token operator">=</span>VALUE           Base directory <span class="token keyword">for</span> documentation installation
                           <span class="token punctuation">(</span>can be empty<span class="token punctuation">)</span> <span class="token punctuation">[</span>share/doc<span class="token punctuation">]</span>
  --enable-block-drv-whitelist-in-tools
                           use block whitelist also <span class="token keyword">in</span> tools instead of only
                           QEMU
  --enable-cfi             Control-Flow Integrity <span class="token punctuation">(</span>CFI<span class="token punctuation">)</span>
  --enable-cfi-debug       Verbose errors <span class="token keyword">in</span> <span class="token keyword">case</span> of CFI violation
  --enable-debug-mutex     mutex debugging support
  --enable-debug-stack-usage
                           measure coroutine stack usage
  --enable-fdt<span class="token punctuation">[</span><span class="token operator">=</span>CHOICE<span class="token punctuation">]</span>    Whether and how to <span class="token function">find</span> the libfdt library
                           <span class="token punctuation">(</span>choices: auto/disabled/enabled/internal/system<span class="token punctuation">)</span>
  --enable-fuzzing         build fuzzing targets
  --enable-gcov            Enable coverage tracking.
  --enable-gprof           QEMU profiling with gprof
  --enable-lto             Use <span class="token function">link</span> <span class="token function">time</span> optimization
  --enable-malloc<span class="token operator">=</span>CHOICE   choose memory allocator to use <span class="token punctuation">[</span>system<span class="token punctuation">]</span> <span class="token punctuation">(</span>choices:
                           jemalloc/system/tcmalloc<span class="token punctuation">)</span>
  --enable-module-upgrades try to load modules from alternate paths <span class="token keyword">for</span>
                           upgrades
  --enable-profiler        profiler support
  --enable-qom-cast-debug  cast debugging support
  --enable-rng-none        dummy RNG, avoid using /dev/<span class="token punctuation">(</span>u<span class="token punctuation">)</span>random and
                           getrandom<span class="token punctuation">(</span><span class="token punctuation">)</span>
  --enable-strip           Strip targets on <span class="token function">install</span>
  --enable-tcg-interpreter TCG with bytecode interpreter <span class="token punctuation">(</span>slow<span class="token punctuation">)</span>
  --enable-trace-backends<span class="token operator">=</span>CHOICES
                           Set available tracing backends <span class="token punctuation">[</span>log<span class="token punctuation">]</span> <span class="token punctuation">(</span>choices:
                           dtrace/ftrace/log/nop/simple/syslog/ust<span class="token punctuation">)</span>
  <span class="token parameter variable">--firmwarepath</span><span class="token operator">=</span>VALUES    search <span class="token environment constant">PATH</span> <span class="token keyword">for</span> firmware files <span class="token punctuation">[</span>share/qemu-firmware<span class="token punctuation">]</span>
  <span class="token parameter variable">--iasl</span><span class="token operator">=</span>VALUE             Path to ACPI disassembler
  <span class="token parameter variable">--includedir</span><span class="token operator">=</span>VALUE       Header <span class="token function">file</span> directory <span class="token punctuation">[</span>include<span class="token punctuation">]</span>
  --interp-prefix<span class="token operator">=</span>VALUE    where to <span class="token function">find</span> shared libraries etc., use %M <span class="token keyword">for</span>
                           cpu name <span class="token punctuation">[</span>/usr/gnemul/qemu-%M<span class="token punctuation">]</span>
  <span class="token parameter variable">--libdir</span><span class="token operator">=</span>VALUE           Library directory <span class="token punctuation">[</span>lib64<span class="token punctuation">]</span>
  <span class="token parameter variable">--libexecdir</span><span class="token operator">=</span>VALUE       Library executable directory <span class="token punctuation">[</span>libexec<span class="token punctuation">]</span>
  <span class="token parameter variable">--localedir</span><span class="token operator">=</span>VALUE        Locale data directory <span class="token punctuation">[</span>share/locale<span class="token punctuation">]</span>
  <span class="token parameter variable">--localstatedir</span><span class="token operator">=</span>VALUE    Localstate data directory <span class="token punctuation">[</span>/var/local<span class="token punctuation">]</span>
  <span class="token parameter variable">--mandir</span><span class="token operator">=</span>VALUE           Manual page directory <span class="token punctuation">[</span>share/man<span class="token punctuation">]</span>
  --sphinx-build<span class="token operator">=</span>VALUE     Use specified sphinx-build <span class="token keyword">for</span> building document
  <span class="token parameter variable">--sysconfdir</span><span class="token operator">=</span>VALUE       Sysconf data directory <span class="token punctuation">[</span>etc<span class="token punctuation">]</span>
  --tls-priority<span class="token operator">=</span>VALUE     Default TLS protocol/cipher priority string
                           <span class="token punctuation">[</span>NORMAL<span class="token punctuation">]</span>
  --with-pkgversion<span class="token operator">=</span>VALUE  use specified string as sub-version of the
                           package
  --with-trace-file<span class="token operator">=</span>VALUE  Trace <span class="token function">file</span> prefix <span class="token keyword">for</span> simple backend <span class="token punctuation">[</span>trace<span class="token punctuation">]</span>

Optional features, enabled with --enable-FEATURE and
disabled with --disable-FEATURE, default is enabled <span class="token keyword">if</span> available
<span class="token punctuation">(</span>unless built with --without-default-features<span class="token punctuation">)</span>:

  alsa            ALSA sound support
  attr            attr/xattr support
  auth-pam        PAM access control
  avx2            AVX2 optimizations
  avx512f         AVX512F optimizations
  blkio           libblkio block device driver
  bochs           bochs image <span class="token function">format</span> support
  bpf             eBPF support
  brlapi          brlapi character device driver
  <span class="token function">bzip2</span>           <span class="token function">bzip2</span> support <span class="token keyword">for</span> DMG images
  canokey         CanoKey support
  cap-ng          cap_ng support
  capstone        Whether and how to <span class="token function">find</span> the capstone library
  cloop           cloop image <span class="token function">format</span> support
  cocoa           Cocoa user interface <span class="token punctuation">(</span>macOS only<span class="token punctuation">)</span>
  coreaudio       CoreAudio sound support
  crypto-afalg    Linux AF_ALG crypto backend driver
  <span class="token function">curl</span>            CURL block device driver
  curses          curses UI
  dbus-display    <span class="token parameter variable">-display</span> dbus support
  dmg             dmg image <span class="token function">format</span> support
  docs            Documentations build support
  dsound          DirectSound sound support
  fuse            FUSE block device <span class="token builtin class-name">export</span>
  fuse-lseek      SEEK_HOLE/SEEK_DATA support <span class="token keyword">for</span> FUSE exports
  gcrypt          libgcrypt cryptography support
  gettext         Localization of the GTK+ user interface
  gio             use libgio <span class="token keyword">for</span> D-Bus support
  glusterfs       Glusterfs block device driver
  gnutls          GNUTLS cryptography support
  gtk             GTK+ user interface
  gtk-clipboard   clipboard support <span class="token keyword">for</span> GTK <span class="token punctuation">(</span>EXPERIMENTAL, MAY HANG<span class="token punctuation">)</span>
  guest-agent     Build QEMU Guest Agent
  guest-agent-msi Build MSI package <span class="token keyword">for</span> the QEMU Guest Agent
  hax             HAX acceleration support
  hvf             HVF acceleration support
  <span class="token function">iconv</span>           Font glyph conversion support
  jack            JACK sound support
  keyring         Linux keyring support
  kvm             KVM acceleration support
  l2tpv3          l2tpv3 network backend support
  libdaxctl       libdaxctl support
  libiscsi        libiscsi userspace initiator
  libnfs          libnfs block device driver
  libpmem         libpmem support
  libssh          <span class="token function">ssh</span> block device support
  libudev         Use libudev to enumerate <span class="token function">host</span> devices
  libusb          libusb support <span class="token keyword">for</span> USB passthrough
  libvduse        build VDUSE Library
  linux-aio       Linux AIO support
  linux-io-uring  Linux io_uring support
  live-block-migration
                  block migration <span class="token keyword">in</span> the main migration stream
  lzfse           lzfse support <span class="token keyword">for</span> DMG images
  lzo             lzo compression support
  malloc-trim     <span class="token builtin class-name">enable</span> libc malloc_trim<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> memory optimization
  membarrier      membarrier system call <span class="token punctuation">(</span>for Linux <span class="token number">4.14</span>+ or Windows
  mpath           Multipath persistent reservation passthrough
  multiprocess    Out of process device emulation support
  netmap          netmap network backend support
  nettle          nettle cryptography support
  numa            libnuma support
  nvmm            NVMM acceleration support
  opengl          OpenGL support
  oss             OSS sound support
  pa              PulseAudio sound support
  parallels       parallels image <span class="token function">format</span> support
  png             PNG support with libpng
  pvrdma          Enable PVRDMA support
  qcow1           qcow1 image <span class="token function">format</span> support
  qed             qed image <span class="token function">format</span> support
  qga-vss         build QGA VSS support <span class="token punctuation">(</span>broken with MinGW<span class="token punctuation">)</span>
  rbd             Ceph block device driver
  rdma            Enable RDMA-based migration
  replication     replication support
  sdl             SDL user interface
  sdl-image       SDL Image support <span class="token keyword">for</span> icons
  seccomp         seccomp support
  selinux         SELinux support <span class="token keyword">in</span> qemu-nbd
  slirp           libslirp user mode network backend support
  slirp-smbd      use smbd <span class="token punctuation">(</span>at path <span class="token parameter variable">--smbd</span><span class="token operator">=</span>*<span class="token punctuation">)</span> <span class="token keyword">in</span> slirp networking
  smartcard       CA smartcard emulation support
  snappy          snappy compression support
  sndio           sndio sound support
  sparse          sparse checker
  spice           Spice server support
  spice-protocol  Spice protocol support
  tcg             TCG support
  tools           build support utilities that come with QEMU
  tpm             TPM support
  u2f             U2F emulation support
  usb-redir       libusbredir support
  vde             vde network backend support
  vdi             vdi image <span class="token function">format</span> support
  vfio-user-server
                  vfio-user server support
  vhost-crypto    vhost-user crypto backend support
  vhost-kernel    vhost kernel backend support
  vhost-net       vhost-net kernel acceleration support
  vhost-user      vhost-user backend support
  vhost-user-blk-server
                  build vhost-user-blk server
  vduse-blk-export
                  VDUSE block <span class="token builtin class-name">export</span> support
  vhost-vdpa      vhost-vdpa kernel backend support
  virglrenderer   virgl rendering support
  virtfs          virtio-9p support
  virtiofsd       build virtiofs daemon <span class="token punctuation">(</span>virtiofsd<span class="token punctuation">)</span>
  vmnet           vmnet.framework network backend support
  vnc             VNC server
  vnc-jpeg        JPEG lossy compression <span class="token keyword">for</span> VNC server
  vnc-sasl        SASL authentication <span class="token keyword">for</span> VNC server
  vte             vte support <span class="token keyword">for</span> the gtk UI
  vvfat           vvfat image <span class="token function">format</span> support
  whpx            WHPX acceleration support
  xen             Xen backend support
  xen-pci-passthrough
                  Xen PCI passthrough support
  xkbcommon       xkbcommon support
  zstd            zstd compression support
  system          all system emulation targets
  user            supported user emulation targets
  linux-user      all linux usermode emulation targets
  bsd-user        all BSD usermode emulation targets
  pie             Position Independent Executables
  modules         modules support <span class="token punctuation">(</span>non-Windows<span class="token punctuation">)</span>
  debug-tcg       TCG debugging <span class="token punctuation">(</span>default is disabled<span class="token punctuation">)</span>
  debug-info      debugging information
  safe-stack      SafeStack Stack Smash Protection. Depends on
                  clang/llvm <span class="token operator">&gt;=</span> <span class="token number">3.7</span> and requires coroutine backend ucontext.

NOTE: The object files are built at the place where configure is launched<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>全量配置如下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> qemu-7.2.0
➜  qemu-7.2.0 ./configure
Using <span class="token string">'./build'</span> as the directory <span class="token keyword">for</span> build output
The Meson build system
Version: <span class="token number">0.61</span>.5
Source dir: /home/jack/Desktop/linux/qemu-7.2.0
Build dir: /home/jack/Desktop/linux/qemu-7.2.0/build
Build type: native build
Project name: qemu
Project version: <span class="token number">7.2</span>.0
C compiler <span class="token keyword">for</span> the <span class="token function">host</span> machine: cc <span class="token parameter variable">-m64</span> <span class="token parameter variable">-mcx16</span> <span class="token punctuation">(</span>gcc <span class="token number">11.3</span>.0 <span class="token string">"cc (Ubuntu 11.3.0-1ubuntu1~22.04) 11.3.0"</span><span class="token punctuation">)</span>
C linker <span class="token keyword">for</span> the <span class="token function">host</span> machine: cc <span class="token parameter variable">-m64</span> <span class="token parameter variable">-mcx16</span> ld.bfd <span class="token number">2.38</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Found ninja-1.10.1 at /usr/bin/ninja

Running postconf script <span class="token string">'/usr/bin/python3 /home/jack/Desktop/linux/qemu-7.2.0/scripts/symlink-install-tree.py'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>全量配置编译比较耗费时间，如果只需要模拟arm环境，可以使用如下配置：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 32位arm配置</span>
./configure --target-list<span class="token operator">=</span>arm-softmmu --audio-drv-list<span class="token operator">=</span>
<span class="token comment"># aarch64配置</span>
./configure --target-list<span class="token operator">=</span>aarch64-softmmu<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li>make</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  qemu-7.2.0 <span class="token function">make</span> <span class="token parameter variable">-j</span> <span class="token number">64</span>
changing <span class="token function">dir</span> to build <span class="token keyword">for</span> <span class="token function">make</span> <span class="token string">""</span><span class="token punctuation">..</span>.
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Entering directory <span class="token string">'/home/jack/Desktop/linux/qemu-7.2.0/build'</span>
/usr/bin/ninja  build.ninja <span class="token operator">&amp;&amp;</span> <span class="token function">touch</span> build.ninja.stamp
ninja: no work to do.
/usr/bin/python3 <span class="token parameter variable">-B</span> /home/jack/Desktop/linux/qemu-7.2.0/meson/meson.py introspect <span class="token parameter variable">--targets</span> <span class="token parameter variable">--tests</span> <span class="token parameter variable">--benchmarks</span> <span class="token operator">|</span> /usr/bin/python3 <span class="token parameter variable">-B</span> scripts/mtest2make.py <span class="token operator">&gt;</span> Makefile.mtest
<span class="token punctuation">[</span><span class="token number">1</span>/9860<span class="token punctuation">]</span> Compiling C object subprojects/libvhost-user/link-test.p/link-test.c.o
<span class="token punctuation">[</span><span class="token number">2</span>/9860<span class="token punctuation">]</span> Compiling C object libfdt.a.p/dtc_libfdt_fdt_wip.c.o
<span class="token punctuation">[</span><span class="token number">3</span>/9860<span class="token punctuation">]</span> Compiling C object libfdt.a.p/dtc_libfdt_fdt_strerror.c.o
<span class="token punctuation">[</span><span class="token number">4</span>/9860<span class="token punctuation">]</span> Compiling C object libfdt.a.p/dtc_libfdt_fdt_empty_tree.c.o
<span class="token punctuation">[</span><span class="token number">5</span>/9860<span class="token punctuation">]</span> Compiling C object libfdt.a.p/dtc_libfdt_fdt_addresses.c.o
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token punctuation">[</span><span class="token number">9858</span>/9860<span class="token punctuation">]</span> Linking target qemu-xtensa
<span class="token punctuation">[</span><span class="token number">9859</span>/9860<span class="token punctuation">]</span> Compiling C object libqemu-xtensaeb-linux-user.fa.p/target_xtensa_core-dsp3400.c.o
<span class="token punctuation">[</span><span class="token number">9860</span>/9860<span class="token punctuation">]</span> Linking target qemu-xtensaeb
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/home/jack/Desktop/linux/qemu-7.2.0/build'</span>
changing <span class="token function">dir</span> to build <span class="token keyword">for</span> <span class="token function">make</span> <span class="token string">""</span><span class="token punctuation">..</span>.
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Entering directory <span class="token string">'/home/jack/Desktop/linux/qemu-7.2.0/build'</span>
<span class="token punctuation">[</span><span class="token number">1</span>/150<span class="token punctuation">]</span> Generating tests/include/QAPI <span class="token builtin class-name">test</span> <span class="token punctuation">(</span>include<span class="token punctuation">)</span> with a custom <span class="token builtin class-name">command</span>
<span class="token punctuation">[</span><span class="token number">2</span>/118<span class="token punctuation">]</span> Generating qemu-version.h with a custom <span class="token builtin class-name">command</span> <span class="token punctuation">(</span>wrapped by meson to capture output<span class="token punctuation">)</span>
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/home/jack/Desktop/linux/qemu-7.2.0/build'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="6">
<li>安装</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  qemu-7.2.0 <span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> jack:
changing <span class="token function">dir</span> to build <span class="token keyword">for</span> <span class="token function">make</span> <span class="token string">"install"</span><span class="token punctuation">..</span>.
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Entering directory <span class="token string">'/home/jack/Desktop/linux/qemu-7.2.0/build'</span>
<span class="token punctuation">[</span><span class="token number">1</span>/118<span class="token punctuation">]</span> Generating qemu-version.h with a custom <span class="token builtin class-name">command</span> <span class="token punctuation">(</span>wrapped by meson to capture output<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">1</span>/2<span class="token punctuation">]</span> Installing files.
Installing trace/trace-events-all to /usr/local/share/qemu
Installing fsdev/virtfs-proxy-helper to /usr/local/libexec
Installing qemu-system-aarch64 to /usr/local/bin
Installing qemu-system-alpha to /usr/local/bin
Installing qemu-system-arm to /usr/local/bin
Installing qemu-system-avr to /usr/local/bin
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Installing /home/jack/Desktop/linux/qemu-7.2.0/pc-bios/keymaps/tr to /usr/local/share/qemu/keymaps
Installing /home/jack/Desktop/linux/qemu-7.2.0/pc-bios/keymaps/sl to /usr/local/share/qemu/keymaps
Installing /home/jack/Desktop/linux/qemu-7.2.0/pc-bios/keymaps/sv to /usr/local/share/qemu/keymaps
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/home/jack/Desktop/linux/qemu-7.2.0/build'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  qemu-7.2.0 /usr/local/bin/qemu-system-aarch64 <span class="token parameter variable">--version</span>
QEMU emulator version <span class="token number">7.2</span>.0
Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2003</span>-2022 Fabrice Bellard and the QEMU Project developers<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h1 id="3-制作根文件系统rootfs"><a href="#3-制作根文件系统rootfs" class="headerlink" title="3 制作根文件系统rootfs"></a>3 制作根文件系统rootfs</h1><h3 id="3-1-下载busybox源码："><a href="#3-1-下载busybox源码：" class="headerlink" title="3.1 下载busybox源码："></a>3.1 下载busybox源码：</h3><p><a target="_blank" rel="noopener" href="http://busybox.net/downloads/">官网</a></p>
<ol>
<li>依赖库安装</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libncurses5-dev libncursesw5-dev <span class="token parameter variable">-y</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li>下载源码</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://busybox.net/downloads/busybox-1.36.0.tar.bz2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li>解压</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> jxvf busybox-1.36.0.tar.bz2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="3-2-配置busybox"><a href="#3-2-配置busybox" class="headerlink" title="3.2 配置busybox"></a>3.2 配置busybox</h3><p>指定编译工具</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> busybox-1.36.0/
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>arm64
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>aarch64-linux-gnu-<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>打开静态库编译选项,保存后退出</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">make</span> menuconfig
Settings ---<span class="token operator">&gt;</span>
 <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Build static binary <span class="token punctuation">(</span>no shared libs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/../../../images/linux/%E4%BD%BF%E7%94%A8qemu%E6%90%AD%E5%BB%BAARM64%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/image-20230320205448996.png" alt="image-20230320205448996"></p>
<h3 id="3-3-编译"><a href="#3-3-编译" class="headerlink" title="3.3 编译"></a>3.3 编译</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  busybox-1.36.0 <span class="token function">make</span> <span class="token parameter variable">-j</span> <span class="token number">64</span>
  SPLIT   include/autoconf.h -<span class="token operator">&gt;</span> include/config/*
  GEN     include/bbconfigopts.h
  GEN     include/common_bufsiz.h
  GEN     include/embedded_scripts.h
  HOSTCC  applets/usage
  HOSTCC  applets/applet_tables
applets/usage.c: In <span class="token keyword">function</span> ‘main’:
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Static linking against glibc, can<span class="token string">'t use --gc-sections
Trying libraries: m resolv rt
 Library m is needed, can'</span>t exclude it <span class="token punctuation">(</span>yet<span class="token punctuation">)</span>
 Library resolv is needed, can<span class="token string">'t exclude it (yet)
 Library rt is not needed, excluding it
 Library m is needed, can'</span>t exclude it <span class="token punctuation">(</span>yet<span class="token punctuation">)</span>
 Library resolv is needed, can't exclude it <span class="token punctuation">(</span>yet<span class="token punctuation">)</span>
Final <span class="token function">link</span> with: m resolv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  busybox-1.36.0 <span class="token function">make</span> <span class="token function">install</span>
  ./_install//bin/arch -<span class="token operator">&gt;</span> busybox
  ./_install//bin/ash -<span class="token operator">&gt;</span> busybox
  ./_install//bin/base32 -<span class="token operator">&gt;</span> busybox
  <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
    ./_install//usr/sbin/tftpd -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/bin/busybox
  ./_install//usr/sbin/ubiattach -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/bin/busybox
  ./_install//usr/sbin/ubidetach -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/bin/busybox
  ./_install//usr/sbin/ubimkvol -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/bin/busybox
  ./_install//usr/sbin/ubirename -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/bin/busybox
  ./_install//usr/sbin/ubirmvol -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/bin/busybox
  ./_install//usr/sbin/ubirsvol -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/bin/busybox
  ./_install//usr/sbin/ubiupdatevol -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/bin/busybox
  ./_install//usr/sbin/udhcpd -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/bin/busybox


--------------------------------------------------
You will probably need to <span class="token function">make</span> your busybox binary
setuid root to ensure all configured applets will
work properly.
--------------------------------------------------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>编译过程报错的话，把相应项去掉即可；编译完成，在busybox生成_install目录</p>
</blockquote>
<h3 id="3-4-补充rootfs目录结构"><a href="#3-4-补充rootfs目录结构" class="headerlink" title="3.4 补充rootfs目录结构"></a>3.4 补充rootfs目录结构</h3><p>1 根目录添加etc、dev和lib目录</p>
<p>etc目录：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  busybox-1.36.0 <span class="token builtin class-name">cd</span> _install
➜  _install <span class="token builtin class-name">pwd</span>
/home/jack/Desktop/linux/busybox-1.36.0/_install
➜  _install <span class="token function">ls</span>
 bin   linuxrc   sbin   usr
➜  _install <span class="token function">mkdir</span> etc dev lib
➜  _install <span class="token function">ls</span>
 bin   dev   etc   lib   linuxrc   sbin   usr
➜  _install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在etc分别创建文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  _install cat<span class="token operator">&gt;</span>etc/profile <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
export HOSTNAME=myQEMU
export USER=root
export HOME=/home
export PS1="[<span class="token environment constant">$USER</span>@<span class="token environment constant">$HOSTNAME</span> \W]\# "
PATH=/bin:/sbin:/usr/bin:/usr/sbin
LD_LIBRARY_PATH=/lib:/usr/lib:<span class="token variable">$LD_LIBRARY_PATH</span>
export PATH LD_LIBRARY_PATH
EOF</span>
➜  _install <span class="token function">cat</span> etc/profile
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">HOSTNAME</span></span><span class="token operator">=</span>myQEMU
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span>root
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/home
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PS1</span></span><span class="token operator">=</span><span class="token string">"[jack@ \W]\# "</span>
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/bin:/sbin:/usr/bin:/usr/sbin
<span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span>/lib:/usr/lib:
<span class="token builtin class-name">export</span> <span class="token environment constant">PATH</span> LD_LIBRARY_PATH<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  _install cat<span class="token operator">&gt;</span>etc/fstab <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
proc /proc proc defaults 0 0
tmpfs /tmp tmpfs defaults 0 0
sysfs /sys sysfs defaults 0 0
tmpfs /dev tmpfs defaults 0 0
debugfs /sys/kernel/debug debugfs defaults 0 0
kmod_mount /mnt 9p trans=virtio 0 0
EOF</span>
➜  _install <span class="token function">cat</span> etc/fstab
proc /proc proc defaults <span class="token number">0</span> <span class="token number">0</span>
tmpfs /tmp tmpfs defaults <span class="token number">0</span> <span class="token number">0</span>
sysfs /sys sysfs defaults <span class="token number">0</span> <span class="token number">0</span>
tmpfs /dev tmpfs defaults <span class="token number">0</span> <span class="token number">0</span>
debugfs /sys/kernel/debug debugfs defaults <span class="token number">0</span> <span class="token number">0</span>
kmod_mount /mnt 9p <span class="token assign-left variable">trans</span><span class="token operator">=</span>virtio <span class="token number">0</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  _install cat<span class="token operator">&gt;</span>etc/inittab <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
::sysinit:/etc/init.d/rcS
::respawn:-/bin/sh
::respawn:-/bin/sh
::ctrlaltdel:/bin/umount -a -r
EOF</span>
➜  _install <span class="token function">cat</span> etc/inittab
::sysinit:/etc/init.d/rcS
::respawn:-/bin/sh
::askfirst:-/bin/sh
::ctrlaltdel:/bin/umount <span class="token parameter variable">-a</span> <span class="token parameter variable">-r</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>指定挂载的文件系统</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  _install <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> etc/init.d
➜  _install cat<span class="token operator">&gt;</span>etc/init.d/rcS <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
mkdir -p /sys
mkdir -p /tmp
mkdir -p /proc
mkdir -p /mnt
/bin/mount -a
mkdir -p /dev/pts
mount -t devpts devpts /dev/pts
echo /sbin/mdev &gt; /proc/sys/kernel/hotplug
mdev -s
EOF</span>
➜  _install <span class="token function">chmod</span> +x etc/init.d/rcS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>dev目录：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  _install <span class="token builtin class-name">cd</span> dev
➜  dev <span class="token function">sudo</span> <span class="token function">mknod</span> console c <span class="token number">5</span> <span class="token number">1</span>
➜  dev <span class="token function">sudo</span> <span class="token function">mknod</span> null c <span class="token number">1</span> <span class="token number">3</span>
➜  dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>lib目录：拷贝lib库，支持动态编译的应用程序运行</p>
<pre class="line-numbers language-none"><code class="language-none">➜  dev cd ../lib
➜  lib cp /usr/aarch64-linux-gnu/lib/*.so*  -a .<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h1 id="4-编译内核"><a href="#4-编译内核" class="headerlink" title="4 编译内核"></a>4 编译内核</h1><h2 id="4-1-下载代码"><a href="#4-1-下载代码" class="headerlink" title="4.1 下载代码"></a>4.1 下载代码</h2><p><a target="_blank" rel="noopener" href="https://www.kernel.org/">官网下载</a>,或者使用下列方法下载</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/luteresa/linux.git <span class="token comment"># 方法1</span>
<span class="token function">git</span> clone https://gitee.com/mirrors/linux_old1.git <span class="token comment"># 方法2</span>
<span class="token function">wget</span> https://mirrors.aliyun.com/linux-kernel/v6.x/linux-6.2.tar.gz <span class="token comment"># 方法3</span>
<span class="token function">wget</span> https://mirrors.edge.kernel.org/pub/linux/kernel/v6.x/linux-6.2.tar.gz <span class="token comment">#方法4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-2-指定编译工具"><a href="#4-2-指定编译工具" class="headerlink" title="4.2 指定编译工具"></a>4.2 指定编译工具</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> linux
➜  linux git:<span class="token punctuation">(</span>master<span class="token punctuation">)</span> <span class="token function">git</span> checkout v6.2
➜  linux git:<span class="token punctuation">(</span>v6.2<span class="token punctuation">)</span> <span class="token builtin class-name">export</span> <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>arm64
➜  linux git:<span class="token punctuation">(</span>v6.2<span class="token punctuation">)</span> <span class="token builtin class-name">export</span> <span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>aarch64-linux-gnu-<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-3-配置内核"><a href="#4-3-配置内核" class="headerlink" title="4.3 配置内核"></a>4.3 配置内核</h2><p>这里采用ARM公司提供的arm64 a57；</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  linux git:<span class="token punctuation">(</span>v6.2<span class="token punctuation">)</span> <span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-ra</span> <span class="token punctuation">..</span>/busybox-1.36.0/_install ./_install_arm64
➜  linux git:<span class="token punctuation">(</span>v6.2<span class="token punctuation">)</span> <span class="token function">cp</span> arch/arm64/configs/defconfig .config
➜  linux git:<span class="token punctuation">(</span>v6.2<span class="token punctuation">)</span> <span class="token function">make</span> menuconfig<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="4-3-1-添加hotplug支持："><a href="#4-3-1-添加hotplug支持：" class="headerlink" title="4.3.1 添加hotplug支持："></a>4.3.1 添加hotplug支持：</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Device Drivers                                                                                             	
	-<span class="token operator">&gt;</span> Generic Driver Options                                                                                   			 
		-<span class="token operator">&gt;</span> Support <span class="token keyword">for</span> uevent helper                                                                                                                
		<span class="token punctuation">(</span>/sbin/hotplug<span class="token punctuation">)</span> path to uevent helper<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/../../../images/linux/%E4%BD%BF%E7%94%A8qemu%E6%90%AD%E5%BB%BAARM64%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/image-20230320221529703.png" alt="image-20230320221529703"></p>
<h3 id="4-3-2-添加initramfs的支持："><a href="#4-3-2-添加initramfs的支持：" class="headerlink" title="4.3.2 添加initramfs的支持："></a>4.3.2 添加initramfs的支持：</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">General setup ---<span class="token operator">&gt;</span>
	<span class="token punctuation">[</span>*<span class="token punctuation">]</span>Initial RAM filesystem and RAM disk<span class="token punctuation">(</span>initramfs/initrd<span class="token punctuation">)</span> support
	<span class="token punctuation">(</span>_install_arm64<span class="token punctuation">)</span> Initramfs souce file<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/../../../images/linux/%E4%BD%BF%E7%94%A8qemu%E6%90%AD%E5%BB%BAARM64%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/image-20230320221728590.png" alt="image-20230320221728590"></p>
<h3 id="4-3-3-内核页配"><a href="#4-3-3-内核页配" class="headerlink" title="4.3.3 内核页配"></a>4.3.3 内核页配</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Kernel Features  ---<span class="token operator">&gt;</span>
	Page size<span class="token punctuation">(</span>4KB<span class="token punctuation">)</span>  ---<span class="token operator">&gt;</span>
	Virtual address space size<span class="token punctuation">(</span><span class="token number">48</span>-bit<span class="token punctuation">)</span>---<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="4-3-4-文件系统配置："><a href="#4-3-4-文件系统配置：" class="headerlink" title="4.3.4 文件系统配置："></a>4.3.4 文件系统配置：</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Kernel hacking  ---<span class="token operator">&gt;</span> 
	 Generic Kernel Debugging Instruments  ---<span class="token operator">&gt;</span>  
	 	 <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Debug Filesystem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/../../../images/linux/%E4%BD%BF%E7%94%A8qemu%E6%90%AD%E5%BB%BAARM64%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/image-20230320221954863.png" alt="image-20230320221954863"></p>
<h2 id="4-4-编译"><a href="#4-4-编译" class="headerlink" title="4.4 编译"></a>4.4 编译</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">make</span> all <span class="token parameter variable">-j64</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>在内核根目录下添加共享目录</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> kmodules<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="4-5-2启动Linux"><a href="#4-5-2启动Linux" class="headerlink" title="4.5 2启动Linux"></a>4.5 2启动Linux</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">qemu-system-aarch64 <span class="token parameter variable">-machine</span> virt <span class="token parameter variable">-cpu</span> cortex-a57 <span class="token parameter variable">-machine</span> <span class="token assign-left variable">type</span><span class="token operator">=</span>virt <span class="token parameter variable">-m</span> <span class="token number">1024</span> <span class="token parameter variable">-smp</span> <span class="token number">4</span> <span class="token parameter variable">-kernel</span> arch/arm64/boot/Image <span class="token parameter variable">--append</span> <span class="token string">"rdinit=/linuxrc root=/dev/vda rw console=ttyAMA0 loglevel=8"</span>  <span class="token parameter variable">-nographic</span> <span class="token parameter variable">--fsdev</span> local,id<span class="token operator">=</span>kmod_dev,path<span class="token operator">=</span><span class="token environment constant">$PWD</span>/kmodules,security_model<span class="token operator">=</span>none <span class="token parameter variable">-device</span> virtio-9p-device,fsdev<span class="token operator">=</span>kmod_dev,mount_tag<span class="token operator">=</span>kmod_mount<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><p>-cpu指定模拟的cpu为 cortex-a57，</p>
</li>
<li><p>-m 1024 指定内存大小为１Ｇ,</p>
</li>
<li><p>-smp4指定模拟的系统为４核处理器 ，</p>
</li>
<li><p>-kernel指定启动的内核镜像，</p>
</li>
<li><p>–append指定传递的命令行参数，</p>
</li>
<li><p>后面的选项指定共享目录已经使用的9P协议。</p>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">➜  linux-6.2 qemu-system-aarch64 <span class="token parameter variable">-machine</span> virt <span class="token parameter variable">-cpu</span> cortex-a57 <span class="token parameter variable">-machine</span> <span class="token assign-left variable">type</span><span class="token operator">=</span>virt <span class="token parameter variable">-m</span> <span class="token number">1024</span> <span class="token parameter variable">-smp</span> <span class="token number">4</span> <span class="token parameter variable">-kernel</span> arch/arm64/boot/Image <span class="token parameter variable">--append</span> <span class="token string">"rdinit=/linuxrc root=/dev/vda rw console=ttyAMA0 loglevel=8"</span>  <span class="token parameter variable">-nographic</span> <span class="token parameter variable">--fsdev</span> local,id<span class="token operator">=</span>kmod_dev,path<span class="token operator">=</span><span class="token environment constant">$PWD</span>/kmodules,security_model<span class="token operator">=</span>none <span class="token parameter variable">-device</span> virtio-9p-device,fsdev<span class="token operator">=</span>kmod_dev,mount_tag<span class="token operator">=</span>kmod_mount
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Booting Linux on physical CPU 0x0000000000 <span class="token punctuation">[</span>0x411fd070<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Linux version <span class="token number">6.2</span>.0 <span class="token punctuation">(</span>jack@jack-HP<span class="token punctuation">)</span> <span class="token punctuation">(</span>aarch64-linux-gnu-gcc <span class="token punctuation">(</span>Ubuntu <span class="token number">11.3</span>.0-1ubuntu1~22.04<span class="token punctuation">)</span> <span class="token number">11.3</span>.0, GNU ld <span class="token punctuation">(</span>GNU Binutils <span class="token keyword">for</span> Ubuntu<span class="token punctuation">)</span> <span class="token number">2.38</span><span class="token punctuation">)</span> <span class="token comment">#1 SMP PREEMPT Tue Mar 21 21:27:39 CST 2023</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> random: crng init <span class="token keyword">done</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Machine model: linux,dummy-virt
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> efi: UEFI not found.
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> NUMA: No NUMA configuration found
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> NUMA: Faking a <span class="token function">node</span> at <span class="token punctuation">[</span>mem 0x0000000040000000-0x000000007fffffff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> NUMA: NODE_DATA <span class="token punctuation">[</span>mem 0x7fdeea00-0x7fdf0fff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Zone ranges:
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span>   DMA      <span class="token punctuation">[</span>mem 0x0000000040000000-0x000000007fffffff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span>   DMA32    empty
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span>   Normal   empty
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Movable zone start <span class="token keyword">for</span> each <span class="token function">node</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Early memory <span class="token function">node</span> ranges
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span>   <span class="token function">node</span>   <span class="token number">0</span>: <span class="token punctuation">[</span>mem 0x0000000040000000-0x000000007fffffff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Initmem setup <span class="token function">node</span> <span class="token number">0</span> <span class="token punctuation">[</span>mem 0x0000000040000000-0x000000007fffffff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> cma: Reserved <span class="token number">32</span> MiB at 0x000000007cc00000
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> psci: probing <span class="token keyword">for</span> conduit method from DT.
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> psci: PSCIv1.1 detected <span class="token keyword">in</span> firmware.
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> psci: Using standard PSCI v0.2 <span class="token keyword">function</span> IDs
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> psci: Trusted OS migration not required
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> psci: SMC Calling Convention v1.0
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> percpu: Embedded <span class="token number">21</span> pages/cpu s45672 r8192 d32152 u86016
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> pcpu-alloc: s45672 r8192 d32152 u86016 <span class="token assign-left variable">alloc</span><span class="token operator">=</span><span class="token number">21</span>*4096
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> pcpu-alloc: <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token number">1</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token number">2</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token number">3</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Detected PIPT I-cache on CPU0
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> CPU features: detected: Spectre-v2
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> CPU features: detected: Spectre-v3a
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> CPU features: detected: Spectre-v4
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> CPU features: detected: Spectre-BHB
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> CPU features: kernel page table isolation forced ON by KASLR
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> CPU features: detected: Kernel page table isolation <span class="token punctuation">(</span>KPTI<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> CPU features: detected: ARM erratum <span class="token number">834220</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> CPU features: detected: ARM erratum <span class="token number">1742098</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> CPU features: detected: ARM erratum <span class="token number">832075</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> CPU features: detected: ARM errata <span class="token number">1165522</span>, <span class="token number">1319367</span>, or <span class="token number">1530923</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> alternatives: applying boot alternatives
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Fallback order <span class="token keyword">for</span> Node <span class="token number">0</span>: <span class="token number">0</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Built <span class="token number">1</span> zonelists, mobility grouping on.  Total pages: <span class="token number">258048</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Policy zone: DMA
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Kernel <span class="token builtin class-name">command</span> line: <span class="token assign-left variable">rdinit</span><span class="token operator">=</span>/linuxrc <span class="token assign-left variable">root</span><span class="token operator">=</span>/dev/vda rw <span class="token assign-left variable">console</span><span class="token operator">=</span>ttyAMA0 <span class="token assign-left variable">loglevel</span><span class="token operator">=</span><span class="token number">8</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Dentry cache <span class="token builtin class-name">hash</span> table entries: <span class="token number">131072</span> <span class="token punctuation">(</span>order: <span class="token number">8</span>, <span class="token number">1048576</span> bytes, linear<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Inode-cache <span class="token builtin class-name">hash</span> table entries: <span class="token number">65536</span> <span class="token punctuation">(</span>order: <span class="token number">7</span>, <span class="token number">524288</span> bytes, linear<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> mem auto-init: stack:off, heap alloc:off, heap free:off
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Memory: 943660K/1048576K available <span class="token punctuation">(</span>16256K kernel code, 3884K rwdata, 9552K rodata, 20224K init, 608K bss, 72148K reserved, 32768K cma-reserved<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> SLUB: <span class="token assign-left variable">HWalign</span><span class="token operator">=</span><span class="token number">64</span>, <span class="token assign-left variable">Order</span><span class="token operator">=</span><span class="token number">0</span>-3, <span class="token assign-left variable">MinObjects</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">CPUs</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">Nodes</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> rcu: Preemptible hierarchical RCU implementation.
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> rcu: 	RCU event tracing is enabled.
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> rcu: 	RCU restricting CPUs from <span class="token assign-left variable">NR_CPUS</span><span class="token operator">=</span><span class="token number">256</span> to <span class="token assign-left variable">nr_cpu_ids</span><span class="token operator">=</span><span class="token number">4</span>.
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> 	Trampoline variant of Tasks RCU enabled.
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> 	Tracing variant of Tasks RCU enabled.
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> rcu: RCU calculated value of scheduler-enlistment delay is <span class="token number">25</span> jiffies.
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> rcu: Adjusting geometry <span class="token keyword">for</span> <span class="token assign-left variable">rcu_fanout_leaf</span><span class="token operator">=</span><span class="token number">16</span>, <span class="token assign-left variable">nr_cpu_ids</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> NR_IRQS: <span class="token number">64</span>, nr_irqs: <span class="token number">64</span>, preallocated irqs: <span class="token number">0</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Root IRQ handler: gic_handle_irq
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> GICv2m: range<span class="token punctuation">[</span>mem 0x08020000-0x08020fff<span class="token punctuation">]</span>, SPI<span class="token punctuation">[</span><span class="token number">80</span>:143<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> rcu: srcu_init: Setting srcu_struct sizes based on contention.
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> arch_timer: cp15 timer<span class="token punctuation">(</span>s<span class="token punctuation">)</span> running at <span class="token number">62</span>.50MHz <span class="token punctuation">(</span>virt<span class="token punctuation">)</span>.
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> clocksource: arch_sys_counter: mask: 0x1ffffffffffffff max_cycles: 0x1cd42e208c, max_idle_ns: <span class="token number">881590405314</span> ns
<span class="token punctuation">[</span>    <span class="token number">0.000107</span><span class="token punctuation">]</span> sched_clock: <span class="token number">57</span> bits at 63MHz, resolution 16ns, wraps every 4398046511096ns
<span class="token punctuation">[</span>    <span class="token number">0.011187</span><span class="token punctuation">]</span> Console: colour dummy device 80x25
<span class="token punctuation">[</span>    <span class="token number">0.013991</span><span class="token punctuation">]</span> Calibrating delay loop <span class="token punctuation">(</span>skipped<span class="token punctuation">)</span>, value calculated using timer frequency<span class="token punctuation">..</span> <span class="token number">125.00</span> BogoMIPS <span class="token punctuation">(</span>lpj<span class="token operator">=</span><span class="token number">250000</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.014168</span><span class="token punctuation">]</span> pid_max: default: <span class="token number">32768</span> minimum: <span class="token number">301</span>
<span class="token punctuation">[</span>    <span class="token number">0.015504</span><span class="token punctuation">]</span> LSM: initializing <span class="token assign-left variable">lsm</span><span class="token operator">=</span>capability,integrity
<span class="token punctuation">[</span>    <span class="token number">0.018576</span><span class="token punctuation">]</span> Mount-cache <span class="token builtin class-name">hash</span> table entries: <span class="token number">2048</span> <span class="token punctuation">(</span>order: <span class="token number">2</span>, <span class="token number">16384</span> bytes, linear<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.018636</span><span class="token punctuation">]</span> Mountpoint-cache <span class="token builtin class-name">hash</span> table entries: <span class="token number">2048</span> <span class="token punctuation">(</span>order: <span class="token number">2</span>, <span class="token number">16384</span> bytes, linear<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.053625</span><span class="token punctuation">]</span> cacheinfo: Unable to detect cache hierarchy <span class="token keyword">for</span> CPU <span class="token number">0</span>
<span class="token punctuation">[</span>    <span class="token number">0.061482</span><span class="token punctuation">]</span> cblist_init_generic: Setting adjustable number of callback queues.
<span class="token punctuation">[</span>    <span class="token number">0.061700</span><span class="token punctuation">]</span> cblist_init_generic: Setting <span class="token builtin class-name">shift</span> to <span class="token number">2</span> and lim to <span class="token number">1</span>.
<span class="token punctuation">[</span>    <span class="token number">0.062121</span><span class="token punctuation">]</span> cblist_init_generic: Setting <span class="token builtin class-name">shift</span> to <span class="token number">2</span> and lim to <span class="token number">1</span>.
<span class="token punctuation">[</span>    <span class="token number">0.064514</span><span class="token punctuation">]</span> rcu: Hierarchical SRCU implementation.
<span class="token punctuation">[</span>    <span class="token number">0.064582</span><span class="token punctuation">]</span> rcu: 	Max phase no-delay instances is <span class="token number">1000</span>.
<span class="token punctuation">[</span>    <span class="token number">0.071040</span><span class="token punctuation">]</span> EFI services will not be available.
<span class="token punctuation">[</span>    <span class="token number">0.073826</span><span class="token punctuation">]</span> smp: Bringing up secondary CPUs <span class="token punctuation">..</span>.
<span class="token punctuation">[</span>    <span class="token number">0.079401</span><span class="token punctuation">]</span> Detected PIPT I-cache on CPU1
<span class="token punctuation">[</span>    <span class="token number">0.080875</span><span class="token punctuation">]</span> cacheinfo: Unable to detect cache hierarchy <span class="token keyword">for</span> CPU <span class="token number">1</span>
<span class="token punctuation">[</span>    <span class="token number">0.081736</span><span class="token punctuation">]</span> CPU1: Booted secondary processor 0x0000000001 <span class="token punctuation">[</span>0x411fd070<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.088068</span><span class="token punctuation">]</span> Detected PIPT I-cache on CPU2
<span class="token punctuation">[</span>    <span class="token number">0.088573</span><span class="token punctuation">]</span> cacheinfo: Unable to detect cache hierarchy <span class="token keyword">for</span> CPU <span class="token number">2</span>
<span class="token punctuation">[</span>    <span class="token number">0.089033</span><span class="token punctuation">]</span> CPU2: Booted secondary processor 0x0000000002 <span class="token punctuation">[</span>0x411fd070<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.091308</span><span class="token punctuation">]</span> Detected PIPT I-cache on CPU3
<span class="token punctuation">[</span>    <span class="token number">0.091565</span><span class="token punctuation">]</span> cacheinfo: Unable to detect cache hierarchy <span class="token keyword">for</span> CPU <span class="token number">3</span>
<span class="token punctuation">[</span>    <span class="token number">0.091766</span><span class="token punctuation">]</span> CPU3: Booted secondary processor 0x0000000003 <span class="token punctuation">[</span>0x411fd070<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.092614</span><span class="token punctuation">]</span> smp: Brought up <span class="token number">1</span> node, <span class="token number">4</span> CPUs
<span class="token punctuation">[</span>    <span class="token number">0.092669</span><span class="token punctuation">]</span> SMP: Total of <span class="token number">4</span> processors activated.
<span class="token punctuation">[</span>    <span class="token number">0.092776</span><span class="token punctuation">]</span> CPU features: detected: <span class="token number">32</span>-bit EL0 Support
<span class="token punctuation">[</span>    <span class="token number">0.092805</span><span class="token punctuation">]</span> CPU features: detected: <span class="token number">32</span>-bit EL1 Support
<span class="token punctuation">[</span>    <span class="token number">0.092886</span><span class="token punctuation">]</span> CPU features: detected: CRC32 instructions
<span class="token punctuation">[</span>    <span class="token number">0.096187</span><span class="token punctuation">]</span> CPU: All CPU<span class="token punctuation">(</span>s<span class="token punctuation">)</span> started at EL1
<span class="token punctuation">[</span>    <span class="token number">0.096404</span><span class="token punctuation">]</span> alternatives: applying system-wide alternatives
<span class="token punctuation">[</span>    <span class="token number">0.136078</span><span class="token punctuation">]</span> devtmpfs: initialized
<span class="token punctuation">[</span>    <span class="token number">0.154495</span><span class="token punctuation">]</span> clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: <span class="token number">7645041785100000</span> ns
<span class="token punctuation">[</span>    <span class="token number">0.154957</span><span class="token punctuation">]</span> futex <span class="token builtin class-name">hash</span> table entries: <span class="token number">1024</span> <span class="token punctuation">(</span>order: <span class="token number">4</span>, <span class="token number">65536</span> bytes, linear<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.160467</span><span class="token punctuation">]</span> pinctrl core: initialized pinctrl subsystem
<span class="token punctuation">[</span>    <span class="token number">0.174737</span><span class="token punctuation">]</span> DMI not present or invalid.
<span class="token punctuation">[</span>    <span class="token number">0.185657</span><span class="token punctuation">]</span> NET: Registered PF_NETLINK/PF_ROUTE protocol family
<span class="token punctuation">[</span>    <span class="token number">0.199069</span><span class="token punctuation">]</span> DMA: preallocated <span class="token number">128</span> KiB GFP_KERNEL pool <span class="token keyword">for</span> atomic allocations
<span class="token punctuation">[</span>    <span class="token number">0.200753</span><span class="token punctuation">]</span> DMA: preallocated <span class="token number">128</span> KiB GFP_KERNEL<span class="token operator">|</span>GFP_DMA pool <span class="token keyword">for</span> atomic allocations
<span class="token punctuation">[</span>    <span class="token number">0.201157</span><span class="token punctuation">]</span> DMA: preallocated <span class="token number">128</span> KiB GFP_KERNEL<span class="token operator">|</span>GFP_DMA32 pool <span class="token keyword">for</span> atomic allocations
<span class="token punctuation">[</span>    <span class="token number">0.201527</span><span class="token punctuation">]</span> audit: initializing netlink subsys <span class="token punctuation">(</span>disabled<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.204521</span><span class="token punctuation">]</span> audit: <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token number">2000</span> audit<span class="token punctuation">(</span><span class="token number">0.172</span>:1<span class="token punctuation">)</span>: <span class="token assign-left variable">state</span><span class="token operator">=</span>initialized <span class="token assign-left variable">audit_enabled</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">res</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>    <span class="token number">0.210761</span><span class="token punctuation">]</span> thermal_sys: Registered thermal governor <span class="token string">'step_wise'</span>
<span class="token punctuation">[</span>    <span class="token number">0.210828</span><span class="token punctuation">]</span> thermal_sys: Registered thermal governor <span class="token string">'power_allocator'</span>
<span class="token punctuation">[</span>    <span class="token number">0.211435</span><span class="token punctuation">]</span> cpuidle: using governor menu
<span class="token punctuation">[</span>    <span class="token number">0.213098</span><span class="token punctuation">]</span> hw-breakpoint: found <span class="token number">6</span> breakpoint and <span class="token number">4</span> watchpoint registers.
<span class="token punctuation">[</span>    <span class="token number">0.214321</span><span class="token punctuation">]</span> ASID allocator initialised with <span class="token number">32768</span> entries
<span class="token punctuation">[</span>    <span class="token number">0.222126</span><span class="token punctuation">]</span> Serial: AMBA PL011 UART driver
<span class="token punctuation">[</span>    <span class="token number">0.266208</span><span class="token punctuation">]</span> <span class="token number">9000000</span>.pl011: ttyAMA0 at MMIO 0x9000000 <span class="token punctuation">(</span>irq <span class="token operator">=</span> <span class="token number">13</span>, base_baud <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> is a PL011 rev1
<span class="token punctuation">[</span>    <span class="token number">0.267591</span><span class="token punctuation">]</span> printk: console <span class="token punctuation">[</span>ttyAMA0<span class="token punctuation">]</span> enabled
<span class="token punctuation">[</span>    <span class="token number">0.311499</span><span class="token punctuation">]</span> KASLR enabled
<span class="token punctuation">[</span>    <span class="token number">0.318457</span><span class="token punctuation">]</span> HugeTLB: registered <span class="token number">1.00</span> GiB page size, pre-allocated <span class="token number">0</span> pages
<span class="token punctuation">[</span>    <span class="token number">0.318885</span><span class="token punctuation">]</span> HugeTLB: <span class="token number">16380</span> KiB vmemmap can be freed <span class="token keyword">for</span> a <span class="token number">1.00</span> GiB page
<span class="token punctuation">[</span>    <span class="token number">0.319737</span><span class="token punctuation">]</span> HugeTLB: registered <span class="token number">32.0</span> MiB page size, pre-allocated <span class="token number">0</span> pages
<span class="token punctuation">[</span>    <span class="token number">0.320164</span><span class="token punctuation">]</span> HugeTLB: <span class="token number">508</span> KiB vmemmap can be freed <span class="token keyword">for</span> a <span class="token number">32.0</span> MiB page
<span class="token punctuation">[</span>    <span class="token number">0.320586</span><span class="token punctuation">]</span> HugeTLB: registered <span class="token number">2.00</span> MiB page size, pre-allocated <span class="token number">0</span> pages
<span class="token punctuation">[</span>    <span class="token number">0.321008</span><span class="token punctuation">]</span> HugeTLB: <span class="token number">28</span> KiB vmemmap can be freed <span class="token keyword">for</span> a <span class="token number">2.00</span> MiB page
<span class="token punctuation">[</span>    <span class="token number">0.321412</span><span class="token punctuation">]</span> HugeTLB: registered <span class="token number">64.0</span> KiB page size, pre-allocated <span class="token number">0</span> pages
<span class="token punctuation">[</span>    <span class="token number">0.321918</span><span class="token punctuation">]</span> HugeTLB: <span class="token number">0</span> KiB vmemmap can be freed <span class="token keyword">for</span> a <span class="token number">64.0</span> KiB page
<span class="token punctuation">[</span>    <span class="token number">0.337378</span><span class="token punctuation">]</span> ACPI: Interpreter disabled.
<span class="token punctuation">[</span>    <span class="token number">0.347007</span><span class="token punctuation">]</span> iommu: Default domain type: Translated
<span class="token punctuation">[</span>    <span class="token number">0.347873</span><span class="token punctuation">]</span> iommu: DMA domain TLB invalidation policy: strict mode
<span class="token punctuation">[</span>    <span class="token number">0.351114</span><span class="token punctuation">]</span> SCSI subsystem initialized
<span class="token punctuation">[</span>    <span class="token number">0.353370</span><span class="token punctuation">]</span> libata version <span class="token number">3.00</span> loaded.
<span class="token punctuation">[</span>    <span class="token number">0.356232</span><span class="token punctuation">]</span> usbcore: registered new interface driver usbfs
<span class="token punctuation">[</span>    <span class="token number">0.357030</span><span class="token punctuation">]</span> usbcore: registered new interface driver hub
<span class="token punctuation">[</span>    <span class="token number">0.357861</span><span class="token punctuation">]</span> usbcore: registered new device driver usb
<span class="token punctuation">[</span>    <span class="token number">0.362416</span><span class="token punctuation">]</span> pps_core: LinuxPPS API ver. <span class="token number">1</span> registered
<span class="token punctuation">[</span>    <span class="token number">0.362800</span><span class="token punctuation">]</span> pps_core: Software ver. <span class="token number">5.3</span>.6 - Copyright <span class="token number">2005</span>-2007 Rodolfo Giometti <span class="token operator">&lt;</span>giometti@linux.it<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>    <span class="token number">0.363567</span><span class="token punctuation">]</span> PTP clock support registered
<span class="token punctuation">[</span>    <span class="token number">0.365001</span><span class="token punctuation">]</span> EDAC MC: Ver: <span class="token number">3.0</span>.0
<span class="token punctuation">[</span>    <span class="token number">0.375621</span><span class="token punctuation">]</span> FPGA manager framework
<span class="token punctuation">[</span>    <span class="token number">0.377753</span><span class="token punctuation">]</span> Advanced Linux Sound Architecture Driver Initialized.
<span class="token punctuation">[</span>    <span class="token number">0.393917</span><span class="token punctuation">]</span> vgaarb: loaded
<span class="token punctuation">[</span>    <span class="token number">0.398474</span><span class="token punctuation">]</span> clocksource: Switched to clocksource arch_sys_counter
<span class="token punctuation">[</span>    <span class="token number">0.401041</span><span class="token punctuation">]</span> VFS: Disk quotas dquot_6.6.0
<span class="token punctuation">[</span>    <span class="token number">0.401583</span><span class="token punctuation">]</span> VFS: Dquot-cache <span class="token builtin class-name">hash</span> table entries: <span class="token number">512</span> <span class="token punctuation">(</span>order <span class="token number">0</span>, <span class="token number">4096</span> bytes<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.405623</span><span class="token punctuation">]</span> pnp: PnP ACPI: disabled
<span class="token punctuation">[</span>    <span class="token number">0.448179</span><span class="token punctuation">]</span> NET: Registered PF_INET protocol family
<span class="token punctuation">[</span>    <span class="token number">0.450797</span><span class="token punctuation">]</span> IP idents <span class="token builtin class-name">hash</span> table entries: <span class="token number">16384</span> <span class="token punctuation">(</span>order: <span class="token number">5</span>, <span class="token number">131072</span> bytes, linear<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.459361</span><span class="token punctuation">]</span> tcp_listen_portaddr_hash <span class="token builtin class-name">hash</span> table entries: <span class="token number">512</span> <span class="token punctuation">(</span>order: <span class="token number">1</span>, <span class="token number">8192</span> bytes, linear<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.459820</span><span class="token punctuation">]</span> Table-perturb <span class="token builtin class-name">hash</span> table entries: <span class="token number">65536</span> <span class="token punctuation">(</span>order: <span class="token number">6</span>, <span class="token number">262144</span> bytes, linear<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.460258</span><span class="token punctuation">]</span> TCP established <span class="token builtin class-name">hash</span> table entries: <span class="token number">8192</span> <span class="token punctuation">(</span>order: <span class="token number">4</span>, <span class="token number">65536</span> bytes, linear<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.460860</span><span class="token punctuation">]</span> TCP <span class="token builtin class-name">bind</span> <span class="token builtin class-name">hash</span> table entries: <span class="token number">8192</span> <span class="token punctuation">(</span>order: <span class="token number">6</span>, <span class="token number">262144</span> bytes, linear<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.461457</span><span class="token punctuation">]</span> TCP: Hash tables configured <span class="token punctuation">(</span>established <span class="token number">8192</span> <span class="token builtin class-name">bind</span> <span class="token number">8192</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.463692</span><span class="token punctuation">]</span> UDP <span class="token builtin class-name">hash</span> table entries: <span class="token number">512</span> <span class="token punctuation">(</span>order: <span class="token number">2</span>, <span class="token number">16384</span> bytes, linear<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.464408</span><span class="token punctuation">]</span> UDP-Lite <span class="token builtin class-name">hash</span> table entries: <span class="token number">512</span> <span class="token punctuation">(</span>order: <span class="token number">2</span>, <span class="token number">16384</span> bytes, linear<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.466512</span><span class="token punctuation">]</span> NET: Registered PF_UNIX/PF_LOCAL protocol family
<span class="token punctuation">[</span>    <span class="token number">0.471516</span><span class="token punctuation">]</span> RPC: Registered named UNIX socket transport module.
<span class="token punctuation">[</span>    <span class="token number">0.471936</span><span class="token punctuation">]</span> RPC: Registered udp transport module.
<span class="token punctuation">[</span>    <span class="token number">0.472161</span><span class="token punctuation">]</span> RPC: Registered tcp transport module.
<span class="token punctuation">[</span>    <span class="token number">0.472369</span><span class="token punctuation">]</span> RPC: Registered tcp NFSv4.1 backchannel transport module.
<span class="token punctuation">[</span>    <span class="token number">0.472825</span><span class="token punctuation">]</span> PCI: CLS <span class="token number">0</span> bytes, default <span class="token number">64</span>
<span class="token punctuation">[</span>    <span class="token number">0.482416</span><span class="token punctuation">]</span> hw perfevents: enabled with armv8_pmuv3 PMU driver, <span class="token number">7</span> counters available
<span class="token punctuation">[</span>    <span class="token number">0.484841</span><span class="token punctuation">]</span> kvm <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: HYP mode not available
<span class="token punctuation">[</span>    <span class="token number">0.495161</span><span class="token punctuation">]</span> Initialise system trusted keyrings
<span class="token punctuation">[</span>    <span class="token number">0.498689</span><span class="token punctuation">]</span> workingset: <span class="token assign-left variable">timestamp_bits</span><span class="token operator">=</span><span class="token number">42</span> <span class="token assign-left variable">max_order</span><span class="token operator">=</span><span class="token number">18</span> <span class="token assign-left variable">bucket_order</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">[</span>    <span class="token number">0.501968</span><span class="token punctuation">]</span> squashfs: version <span class="token number">4.0</span> <span class="token punctuation">(</span><span class="token number">2009</span>/01/31<span class="token punctuation">)</span> Phillip Lougher
<span class="token punctuation">[</span>    <span class="token number">0.505377</span><span class="token punctuation">]</span> NFS: Registering the id_resolver key <span class="token builtin class-name">type</span>
<span class="token punctuation">[</span>    <span class="token number">0.505844</span><span class="token punctuation">]</span> Key <span class="token builtin class-name">type</span> id_resolver registered
<span class="token punctuation">[</span>    <span class="token number">0.506776</span><span class="token punctuation">]</span> Key <span class="token builtin class-name">type</span> id_legacy registered
<span class="token punctuation">[</span>    <span class="token number">0.507705</span><span class="token punctuation">]</span> nfs4filelayout_init: NFSv4 File Layout Driver Registering<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>    <span class="token number">0.508232</span><span class="token punctuation">]</span> nfs4flexfilelayout_init: NFSv4 Flexfile Layout Driver Registering<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>    <span class="token number">0.511093</span><span class="token punctuation">]</span> 9p: Installing v9fs 9p2000 <span class="token function">file</span> system support
<span class="token punctuation">[</span>    <span class="token number">0.561320</span><span class="token punctuation">]</span> Key <span class="token builtin class-name">type</span> asymmetric registered
<span class="token punctuation">[</span>    <span class="token number">0.562183</span><span class="token punctuation">]</span> Asymmetric key parser <span class="token string">'x509'</span> registered
<span class="token punctuation">[</span>    <span class="token number">0.563477</span><span class="token punctuation">]</span> Block layer SCSI generic <span class="token punctuation">(</span>bsg<span class="token punctuation">)</span> driver version <span class="token number">0.4</span> loaded <span class="token punctuation">(</span>major <span class="token number">245</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.565031</span><span class="token punctuation">]</span> io scheduler mq-deadline registered
<span class="token punctuation">[</span>    <span class="token number">0.565751</span><span class="token punctuation">]</span> io scheduler kyber registered
<span class="token punctuation">[</span>    <span class="token number">0.642221</span><span class="token punctuation">]</span> pl061_gpio <span class="token number">9030000</span>.pl061: PL061 GPIO chip registered
<span class="token punctuation">[</span>    <span class="token number">0.664236</span><span class="token punctuation">]</span> pci-host-generic <span class="token number">4010000000</span>.pcie: <span class="token function">host</span> bridge /pcie@10000000 ranges:
<span class="token punctuation">[</span>    <span class="token number">0.667113</span><span class="token punctuation">]</span> pci-host-generic <span class="token number">4010000000</span>.pcie:       IO 0x003eff0000<span class="token punctuation">..</span>0x003effffff -<span class="token operator">&gt;</span> 0x0000000000
<span class="token punctuation">[</span>    <span class="token number">0.669630</span><span class="token punctuation">]</span> pci-host-generic <span class="token number">4010000000</span>.pcie:      MEM 0x0010000000<span class="token punctuation">..</span>0x003efeffff -<span class="token operator">&gt;</span> 0x0010000000
<span class="token punctuation">[</span>    <span class="token number">0.670999</span><span class="token punctuation">]</span> pci-host-generic <span class="token number">4010000000</span>.pcie:      MEM 0x8000000000<span class="token punctuation">..</span>0xffffffffff -<span class="token operator">&gt;</span> 0x8000000000
<span class="token punctuation">[</span>    <span class="token number">0.672606</span><span class="token punctuation">]</span> pci-host-generic <span class="token number">4010000000</span>.pcie: Memory resource size exceeds max <span class="token keyword">for</span> <span class="token number">32</span> bits
<span class="token punctuation">[</span>    <span class="token number">0.674647</span><span class="token punctuation">]</span> pci-host-generic <span class="token number">4010000000</span>.pcie: ECAM at <span class="token punctuation">[</span>mem 0x4010000000-0x401fffffff<span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token punctuation">[</span>bus 00-ff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.678818</span><span class="token punctuation">]</span> pci-host-generic <span class="token number">4010000000</span>.pcie: PCI <span class="token function">host</span> bridge to bus 0000:00
<span class="token punctuation">[</span>    <span class="token number">0.679499</span><span class="token punctuation">]</span> pci_bus 0000:00: root bus resource <span class="token punctuation">[</span>bus 00-ff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.679843</span><span class="token punctuation">]</span> pci_bus 0000:00: root bus resource <span class="token punctuation">[</span>io  0x0000-0xffff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.680176</span><span class="token punctuation">]</span> pci_bus 0000:00: root bus resource <span class="token punctuation">[</span>mem 0x10000000-0x3efeffff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.680473</span><span class="token punctuation">]</span> pci_bus 0000:00: root bus resource <span class="token punctuation">[</span>mem 0x8000000000-0xffffffffff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.683207</span><span class="token punctuation">]</span> pci 0000:00:00.0: <span class="token punctuation">[</span>1b36:0008<span class="token punctuation">]</span> <span class="token builtin class-name">type</span> 00 class 0x060000
<span class="token punctuation">[</span>    <span class="token number">0.689317</span><span class="token punctuation">]</span> pci 0000:00:01.0: <span class="token punctuation">[</span>1af4:1000<span class="token punctuation">]</span> <span class="token builtin class-name">type</span> 00 class 0x020000
<span class="token punctuation">[</span>    <span class="token number">0.690302</span><span class="token punctuation">]</span> pci 0000:00:01.0: reg 0x10: <span class="token punctuation">[</span>io  0x0000-0x001f<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.690656</span><span class="token punctuation">]</span> pci 0000:00:01.0: reg 0x14: <span class="token punctuation">[</span>mem 0x00000000-0x00000fff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.691027</span><span class="token punctuation">]</span> pci 0000:00:01.0: reg 0x20: <span class="token punctuation">[</span>mem 0x00000000-0x00003fff 64bit pref<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.691459</span><span class="token punctuation">]</span> pci 0000:00:01.0: reg 0x30: <span class="token punctuation">[</span>mem 0x00000000-0x0003ffff pref<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.696646</span><span class="token punctuation">]</span> pci 0000:00:01.0: BAR <span class="token number">6</span>: assigned <span class="token punctuation">[</span>mem 0x10000000-0x1003ffff pref<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.697543</span><span class="token punctuation">]</span> pci 0000:00:01.0: BAR <span class="token number">4</span>: assigned <span class="token punctuation">[</span>mem 0x8000000000-0x8000003fff 64bit pref<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.698459</span><span class="token punctuation">]</span> pci 0000:00:01.0: BAR <span class="token number">1</span>: assigned <span class="token punctuation">[</span>mem 0x10040000-0x10040fff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.698783</span><span class="token punctuation">]</span> pci 0000:00:01.0: BAR <span class="token number">0</span>: assigned <span class="token punctuation">[</span>io  0x1000-0x101f<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">0.718682</span><span class="token punctuation">]</span> EINJ: ACPI disabled.
<span class="token punctuation">[</span>    <span class="token number">0.884711</span><span class="token punctuation">]</span> virtio-pci 0000:00:01.0: enabling device <span class="token punctuation">(</span>0000 -<span class="token operator">&gt;</span> 0003<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">0.932982</span><span class="token punctuation">]</span> Serial: <span class="token number">8250</span>/16550 driver, <span class="token number">4</span> ports, IRQ sharing enabled
<span class="token punctuation">[</span>    <span class="token number">0.954887</span><span class="token punctuation">]</span> SuperH <span class="token punctuation">(</span>H<span class="token punctuation">)</span>SCI<span class="token punctuation">(</span>F<span class="token punctuation">)</span> driver initialized
<span class="token punctuation">[</span>    <span class="token number">0.958849</span><span class="token punctuation">]</span> msm_serial: driver initialized
<span class="token punctuation">[</span>    <span class="token number">0.974654</span><span class="token punctuation">]</span> cacheinfo: Unable to detect cache hierarchy <span class="token keyword">for</span> CPU <span class="token number">0</span>
<span class="token punctuation">[</span>    <span class="token number">1.015829</span><span class="token punctuation">]</span> loop: module loaded
<span class="token punctuation">[</span>    <span class="token number">1.030271</span><span class="token punctuation">]</span> megasas: 07.719.03.00-rc1
<span class="token punctuation">[</span>    <span class="token number">1.047200</span><span class="token punctuation">]</span> physmap-flash <span class="token number">0</span>.flash: physmap platform flash device: <span class="token punctuation">[</span>mem 0x00000000-0x03ffffff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">1.049404</span><span class="token punctuation">]</span> <span class="token number">0</span>.flash: Found <span class="token number">2</span> x16 devices at 0x0 <span class="token keyword">in</span> <span class="token number">32</span>-bit bank. Manufacturer ID 0x000000 Chip ID 0x000000
<span class="token punctuation">[</span>    <span class="token number">1.050782</span><span class="token punctuation">]</span> Intel/Sharp Extended Query Table at 0x0031
<span class="token punctuation">[</span>    <span class="token number">1.052283</span><span class="token punctuation">]</span> Using buffer <span class="token function">write</span> method
<span class="token punctuation">[</span>    <span class="token number">1.052891</span><span class="token punctuation">]</span> erase region <span class="token number">0</span>: <span class="token assign-left variable">offset</span><span class="token operator">=</span>0x0,size<span class="token operator">=</span>0x40000,blocks<span class="token operator">=</span><span class="token number">256</span>
<span class="token punctuation">[</span>    <span class="token number">1.053495</span><span class="token punctuation">]</span> physmap-flash <span class="token number">0</span>.flash: physmap platform flash device: <span class="token punctuation">[</span>mem 0x04000000-0x07ffffff<span class="token punctuation">]</span>
<span class="token punctuation">[</span>    <span class="token number">1.055128</span><span class="token punctuation">]</span> <span class="token number">0</span>.flash: Found <span class="token number">2</span> x16 devices at 0x0 <span class="token keyword">in</span> <span class="token number">32</span>-bit bank. Manufacturer ID 0x000000 Chip ID 0x000000
<span class="token punctuation">[</span>    <span class="token number">1.055665</span><span class="token punctuation">]</span> Intel/Sharp Extended Query Table at 0x0031
<span class="token punctuation">[</span>    <span class="token number">1.056650</span><span class="token punctuation">]</span> Using buffer <span class="token function">write</span> method
<span class="token punctuation">[</span>    <span class="token number">1.056875</span><span class="token punctuation">]</span> erase region <span class="token number">0</span>: <span class="token assign-left variable">offset</span><span class="token operator">=</span>0x0,size<span class="token operator">=</span>0x40000,blocks<span class="token operator">=</span><span class="token number">256</span>
<span class="token punctuation">[</span>    <span class="token number">1.057302</span><span class="token punctuation">]</span> Concatenating MTD devices:
<span class="token punctuation">[</span>    <span class="token number">1.057494</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>: <span class="token string">"0.flash"</span>
<span class="token punctuation">[</span>    <span class="token number">1.057632</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token string">"0.flash"</span>
<span class="token punctuation">[</span>    <span class="token number">1.057787</span><span class="token punctuation">]</span> into device <span class="token string">"0.flash"</span>
<span class="token punctuation">[</span>    <span class="token number">1.769909</span><span class="token punctuation">]</span> tun: Universal TUN/TAP device driver, <span class="token number">1.6</span>
<span class="token punctuation">[</span>    <span class="token number">1.799892</span><span class="token punctuation">]</span> thunder_xcv, ver <span class="token number">1.0</span>
<span class="token punctuation">[</span>    <span class="token number">1.801331</span><span class="token punctuation">]</span> thunder_bgx, ver <span class="token number">1.0</span>
<span class="token punctuation">[</span>    <span class="token number">1.803667</span><span class="token punctuation">]</span> nicpf, ver <span class="token number">1.0</span>
<span class="token punctuation">[</span>    <span class="token number">1.820402</span><span class="token punctuation">]</span> hns3: Hisilicon Ethernet Network Driver <span class="token keyword">for</span> Hip08 Family - version
<span class="token punctuation">[</span>    <span class="token number">1.821282</span><span class="token punctuation">]</span> hns3: Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2017</span> Huawei Corporation.
<span class="token punctuation">[</span>    <span class="token number">1.822624</span><span class="token punctuation">]</span> hclge is initializing
<span class="token punctuation">[</span>    <span class="token number">1.823014</span><span class="token punctuation">]</span> e1000: Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> PRO/1000 Network Driver
<span class="token punctuation">[</span>    <span class="token number">1.823381</span><span class="token punctuation">]</span> e1000: Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1999</span>-2006 Intel Corporation.
<span class="token punctuation">[</span>    <span class="token number">1.823928</span><span class="token punctuation">]</span> e1000e: Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> PRO/1000 Network Driver
<span class="token punctuation">[</span>    <span class="token number">1.824423</span><span class="token punctuation">]</span> e1000e: Copyright<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1999</span> - <span class="token number">2015</span> Intel Corporation.
<span class="token punctuation">[</span>    <span class="token number">1.825247</span><span class="token punctuation">]</span> igb: Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Gigabit Ethernet Network Driver
<span class="token punctuation">[</span>    <span class="token number">1.825717</span><span class="token punctuation">]</span> igb: Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2007</span>-2014 Intel Corporation.
<span class="token punctuation">[</span>    <span class="token number">1.827861</span><span class="token punctuation">]</span> igbvf: Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Gigabit Virtual Function Network Driver
<span class="token punctuation">[</span>    <span class="token number">1.828364</span><span class="token punctuation">]</span> igbvf: Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2009</span> - <span class="token number">2012</span> Intel Corporation.
<span class="token punctuation">[</span>    <span class="token number">1.832453</span><span class="token punctuation">]</span> sky2: driver version <span class="token number">1.30</span>
<span class="token punctuation">[</span>    <span class="token number">1.845694</span><span class="token punctuation">]</span> VFIO - User Level meta-driver version: <span class="token number">0.3</span>
<span class="token punctuation">[</span>    <span class="token number">1.873853</span><span class="token punctuation">]</span> usbcore: registered new interface driver usb-storage
<span class="token punctuation">[</span>    <span class="token number">1.912107</span><span class="token punctuation">]</span> rtc-pl031 <span class="token number">9010000</span>.pl031: registered as rtc0
<span class="token punctuation">[</span>    <span class="token number">1.913604</span><span class="token punctuation">]</span> rtc-pl031 <span class="token number">9010000</span>.pl031: setting system clock to <span class="token number">2023</span>-03-21T14:03:37 UTC <span class="token punctuation">(</span><span class="token number">1679407417</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">1.920946</span><span class="token punctuation">]</span> i2c_dev: i2c /dev entries driver
<span class="token punctuation">[</span>    <span class="token number">1.977675</span><span class="token punctuation">]</span> ghes_edac: GHES probing device list is empty
<span class="token punctuation">[</span>    <span class="token number">1.993502</span><span class="token punctuation">]</span> sdhci: Secure Digital Host Controller Interface driver
<span class="token punctuation">[</span>    <span class="token number">1.996446</span><span class="token punctuation">]</span> sdhci: Copyright<span class="token punctuation">(</span>c<span class="token punctuation">)</span> Pierre Ossman
<span class="token punctuation">[</span>    <span class="token number">2.005337</span><span class="token punctuation">]</span> Synopsys Designware Multimedia Card Interface Driver
<span class="token punctuation">[</span>    <span class="token number">2.016116</span><span class="token punctuation">]</span> sdhci-pltfm: SDHCI platform and OF driver helper
<span class="token punctuation">[</span>    <span class="token number">2.037350</span><span class="token punctuation">]</span> ledtrig-cpu: registered to indicate activity on CPUs
<span class="token punctuation">[</span>    <span class="token number">2.060641</span><span class="token punctuation">]</span> usbcore: registered new interface driver usbhid
<span class="token punctuation">[</span>    <span class="token number">2.061289</span><span class="token punctuation">]</span> usbhid: USB HID core driver
<span class="token punctuation">[</span>    <span class="token number">2.134717</span><span class="token punctuation">]</span> NET: Registered PF_PACKET protocol family
<span class="token punctuation">[</span>    <span class="token number">2.136285</span><span class="token punctuation">]</span> 9pnet: Installing 9P2000 support
<span class="token punctuation">[</span>    <span class="token number">2.139040</span><span class="token punctuation">]</span> Key <span class="token builtin class-name">type</span> dns_resolver registered
<span class="token punctuation">[</span>    <span class="token number">2.394485</span><span class="token punctuation">]</span> registered taskstats version <span class="token number">1</span>
<span class="token punctuation">[</span>    <span class="token number">2.398687</span><span class="token punctuation">]</span> Loading compiled-in X.509 certificates
<span class="token punctuation">[</span>    <span class="token number">2.427898</span><span class="token punctuation">]</span> input: gpio-keys as /devices/platform/gpio-keys/input/input0
<span class="token punctuation">[</span>    <span class="token number">2.443319</span><span class="token punctuation">]</span> ALSA device list:
<span class="token punctuation">[</span>    <span class="token number">2.443778</span><span class="token punctuation">]</span>   No soundcards found.
<span class="token punctuation">[</span>    <span class="token number">2.448472</span><span class="token punctuation">]</span> uart-pl011 <span class="token number">9000000</span>.pl011: no DMA platform data
<span class="token punctuation">[</span>    <span class="token number">2.620782</span><span class="token punctuation">]</span> Freeing unused kernel memory: 20224K
<span class="token punctuation">[</span>    <span class="token number">2.622695</span><span class="token punctuation">]</span> Run /linuxrc as init process
<span class="token punctuation">[</span>    <span class="token number">2.622932</span><span class="token punctuation">]</span>   with arguments:
<span class="token punctuation">[</span>    <span class="token number">2.623086</span><span class="token punctuation">]</span>     /linuxrc
<span class="token punctuation">[</span>    <span class="token number">2.623191</span><span class="token punctuation">]</span>   with environment:
<span class="token punctuation">[</span>    <span class="token number">2.623333</span><span class="token punctuation">]</span>     <span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/
<span class="token punctuation">[</span>    <span class="token number">2.623444</span><span class="token punctuation">]</span>     <span class="token assign-left variable"><span class="token environment constant">TERM</span></span><span class="token operator">=</span>linux

Please press Enter to activate this console.
<span class="token punctuation">[</span>jack@ <span class="token punctuation">]</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>关于Please press Enter to activate this console.</p>
<p>如果想要直接不敲回车，自动进入模拟系统</p>
<p>需要修改etc/inittab，将::askfirst:-/bin/sh修改为::respawn:-/bin/sh</p>
</blockquote>
<h1 id="5-使用模拟磁盘"><a href="#5-使用模拟磁盘" class="headerlink" title="5 使用模拟磁盘"></a>5 使用模拟磁盘</h1><p>上述initramfs的方式，将根文件系统打包到内核源码，运行时都是在内存中，可以操作，但系统重启就会丢失，下面用模拟磁盘方式挂载根文件系统。</p>
<p>制作磁盘文件:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>rootfs_ext4.img <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1024</span>
mkfs.ext4 rootfs_ext4.img
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> tmpfs
<span class="token function">sudo</span> <span class="token function">mount</span>  <span class="token parameter variable">-t</span> ext4 rootfs_ext4.img  tmpfs/ <span class="token parameter variable">-o</span> loop
<span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-af</span> _install_arm64/* tmpfs/
<span class="token function">sudo</span> <span class="token function">umount</span>  tmpfs
<span class="token function">chmod</span> <span class="token number">777</span> rootfs_ext4.img<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>rootfs_ext4.img就是即将用来挂载的磁盘；</p>
<p>再次启动内核：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">qemu-system-aarch64 <span class="token parameter variable">-machine</span> virt <span class="token parameter variable">-cpu</span> cortex-a57 <span class="token parameter variable">-machine</span> <span class="token assign-left variable">type</span><span class="token operator">=</span>virt <span class="token parameter variable">-m</span> <span class="token number">1024</span> <span class="token parameter variable">-smp</span> <span class="token number">4</span> <span class="token parameter variable">-kernel</span> arch/arm64/boot/Image <span class="token parameter variable">--append</span> <span class="token string">"noinitrd root=/dev/vda rw console=ttyAMA0 loglevel=8"</span>  <span class="token parameter variable">-nographic</span> <span class="token parameter variable">-drive</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>none,file<span class="token operator">=</span>rootfs_ext4.img,id<span class="token operator">=</span>hd0 <span class="token parameter variable">-device</span> virtio-blk-device,drive<span class="token operator">=</span>hd0 <span class="token parameter variable">--fsdev</span> local,id<span class="token operator">=</span>kmod_dev,path<span class="token operator">=</span><span class="token environment constant">$PWD</span>/kmodules,security_model<span class="token operator">=</span>none <span class="token parameter variable">-device</span> virtio-9p-device,fsdev<span class="token operator">=</span>kmod_dev,mount_tag<span class="token operator">=</span>kmod_mount<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>传递给内核的命令行参数变化了，添加了noinitrd选项，这样就会挂载我们自己的模拟磁盘。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@myQEMU <span class="token punctuation">]</span>
Filesystem                Size      Used Available Use% Mounted on
/dev/root               <span class="token number">975</span>.9M     <span class="token number">12</span>.8M    <span class="token number">895</span>.9M   <span class="token number">1</span>% /
tmpfs                   <span class="token number">496</span>.1M         <span class="token number">0</span>    <span class="token number">496</span>.1M   <span class="token number">0</span>% /tmp
tmpfs                   <span class="token number">496</span>.1M         <span class="token number">0</span>    <span class="token number">496</span>.1M   <span class="token number">0</span>% /dev
kmod_mount              <span class="token number">981</span>.8G     <span class="token number">32</span>.5G    <span class="token number">899</span>.4G   <span class="token number">3</span>% /mnt
<span class="token punctuation">[</span>root@myQEMU <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这样在文件系统的读写，就会存在磁盘，重启后，数据不会丢失。</p>
<blockquote>
<p>[    2.403424] —[ end Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(254,0) ]—</p>
</blockquote>
<h1 id="6-qemu与主机ubuntu文件共享"><a href="#6-qemu与主机ubuntu文件共享" class="headerlink" title="6 qemu与主机ubuntu文件共享"></a>6 qemu与主机ubuntu文件共享</h1><p>前面已经支持了主机和qemu上的系统共享目录，这个目录就是kmodules目录：</p>
<p>通过mount可以查看被挂载到了qemu上的系统的/mnt目录下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>jack@ mnt<span class="token punctuation">]</span><span class="token comment"># mount</span>
rootfs on / <span class="token builtin class-name">type</span> rootfs <span class="token punctuation">(</span>rw<span class="token punctuation">)</span>
proc on /proc <span class="token builtin class-name">type</span> proc <span class="token punctuation">(</span>rw,relatime<span class="token punctuation">)</span>
tmpfs on /tmp <span class="token builtin class-name">type</span> tmpfs <span class="token punctuation">(</span>rw,relatime<span class="token punctuation">)</span>
sysfs on /sys <span class="token builtin class-name">type</span> sysfs <span class="token punctuation">(</span>rw,relatime<span class="token punctuation">)</span>
tmpfs on /dev <span class="token builtin class-name">type</span> tmpfs <span class="token punctuation">(</span>rw,relatime<span class="token punctuation">)</span>
debugfs on /sys/kernel/debug <span class="token builtin class-name">type</span> debugfs <span class="token punctuation">(</span>rw,relatime<span class="token punctuation">)</span>
kmod_mount on /mnt <span class="token builtin class-name">type</span> 9p <span class="token punctuation">(</span>rw,sync,dirsync,relatime,access<span class="token operator">=</span>client,trans<span class="token operator">=</span>virtio<span class="token punctuation">)</span>
devpts on /dev/pts <span class="token builtin class-name">type</span> devpts <span class="token punctuation">(</span>rw,relatime,mode<span class="token operator">=</span><span class="token number">600</span>,ptmxmode<span class="token operator">=</span>000<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在ubuntu的kmodules目录，创建一个文件hello.c</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World,Qemu!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在qemu查看</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>jack@ mnt<span class="token punctuation">]</span><span class="token comment">#cat hello.c</span>
<span class="token comment">#include &lt;stdio.h&gt;</span>
int main<span class="token punctuation">(</span>int argc, char **argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	printf<span class="token punctuation">(</span><span class="token string">"Hello World,Qemu!<span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token builtin class-name">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在ubuntu编译，</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aarch64-linux-gnu-gcc  hello.c<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>在qemu运行，</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>jack@ mnt<span class="token punctuation">]</span><span class="token comment"># ./a.out</span>
Hello World,Qemu<span class="token operator">!</span>
<span class="token punctuation">[</span>jack@ mnt<span class="token punctuation">]</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>可见，在共享目录，可以执行含动态库的应用程序；</p>
<h1 id="7-内核模块测试："><a href="#7-内核模块测试：" class="headerlink" title="7 内核模块测试："></a>7 内核模块测试：</h1><p>Makefile文件，</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">KERNEL_DIR ?<span class="token operator">=</span> ~/work/Linux/linux
obj-m :<span class="token operator">=</span> module_test.o
modules:
	<span class="token variable"><span class="token variable">$(</span>MAKE<span class="token variable">)</span></span> <span class="token parameter variable">-C</span> <span class="token variable"><span class="token variable">$(</span>KERNEL_DIR<span class="token variable">)</span></span> <span class="token assign-left variable">M</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token environment constant">PWD</span><span class="token variable">)</span></span> modules
clean: 
	<span class="token variable"><span class="token variable">$(</span>MAKE<span class="token variable">)</span></span> <span class="token parameter variable">-C</span> <span class="token variable"><span class="token variable">$(</span>KERNEL_DIR<span class="token variable">)</span></span> <span class="token assign-left variable">M</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token environment constant">PWD</span><span class="token variable">)</span></span> clean
install:         
	<span class="token function">cp</span> *.ko <span class="token variable"><span class="token variable">$(</span>KERNEL_DIR<span class="token variable">)</span></span>/kmodules<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>驱动测试文件model_test.c，</p>
<pre class="line-numbers language-none"><code class="language-none">#include &lt;linux/init.h&gt;
#include &lt;linux/module.h&gt;
#include &lt;linux/kernel.h&gt;
   static int __init module_test_init(void)
{
        printk("---module_test_init\n");
        return 0;
}    
  
  static void __exit module_test_exit(void)
{
        printk("---module_test_exit\n");
}
  
  
module_init(module_test_init);
module_exit(module_test_exit);
MODULE_LICENSE("GPL");` 

![](https://csdnimg.cn/release/blogv2/dist/pc/img/newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在ubuntu上交叉编译</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">leon@leon:~/work/Linux/linux/kmodules$ <span class="token function">make</span>
<span class="token function">make</span> <span class="token parameter variable">-C</span> ~/work/Linux/linux <span class="token assign-left variable">M</span><span class="token operator">=</span>/home/leon/work/Linux/linux/kmodules modules
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Entering directory <span class="token string">'/home/leon/work/Linux/linux'</span>
  CC <span class="token punctuation">[</span>M<span class="token punctuation">]</span>  /home/leon/work/Linux/linux/kmodules/module_test.o
  MODPOST /home/leon/work/Linux/linux/kmodules/Module.symvers
  CC <span class="token punctuation">[</span>M<span class="token punctuation">]</span>  /home/leon/work/Linux/linux/kmodules/module_test.mod.o
  LD <span class="token punctuation">[</span>M<span class="token punctuation">]</span>  /home/leon/work/Linux/linux/kmodules/module_test.ko
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/home/leon/work/Linux/linux'</span>
leon@leon:~/work/Linux/linux/kmodules$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在qemu加载驱动</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@myQEMU mnt<span class="token punctuation">]</span>
---module_test_init.
<span class="token punctuation">[</span>root@myQEMU mnt<span class="token punctuation">]</span>
---module_test_exit.
<span class="token punctuation">[</span>root@myQEMU mnt<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可见，内核模块正常运行了。</p>
<h1 id="8-gdb调试"><a href="#8-gdb调试" class="headerlink" title="8 gdb调试"></a>8 gdb调试</h1><p>安装arm-none-eabi-gdb</p>
<p><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/1243252/how-to-install-arm-none-eabi-gdb-on-ubuntu-20-04-lts-focal-fossa">https://askubuntu.com/questions/1243252/how-to-install-arm-none-eabi-gdb-on-ubuntu-20-04-lts-focal-fossa</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> gdb-multiarch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>qemu模拟端启动内核：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">qemu-system-aarch64 <span class="token parameter variable">-machine</span> virt <span class="token parameter variable">-cpu</span> cortex-a57 <span class="token parameter variable">-machine</span> <span class="token assign-left variable">type</span><span class="token operator">=</span>virt <span class="token parameter variable">-m</span> <span class="token number">1024</span> <span class="token parameter variable">-smp</span> <span class="token number">4</span> <span class="token parameter variable">-kernel</span> arch/arm64/boot/Image <span class="token parameter variable">--append</span> <span class="token string">"rdinit=/linuxrc root=/dev/vda rw console=ttyAMA0 loglevel=8"</span>  <span class="token parameter variable">-nographic</span> <span class="token parameter variable">--fsdev</span> local,id<span class="token operator">=</span>kmod_dev,path<span class="token operator">=</span><span class="token environment constant">$PWD</span>/k_shared,security_model<span class="token operator">=</span>none <span class="token parameter variable">-device</span> virtio-9p-device,fsdev<span class="token operator">=</span>kmod_dev,mount_tag<span class="token operator">=</span>kmod_mount  <span class="token parameter variable">-S</span>  <span class="token parameter variable">-s</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>X86启动gdb：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gdb-multiarch <span class="token parameter variable">--tui</span> vmlinux<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span>target remote localhost:1234  //通过1234端口远程连接到qemu端
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span>b start_kernel				   //在内核的start_kernel设置断点
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span>c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>如图，gdb接管linux内核，在断点处(start_kernel)暂停，即可通过gdb来调试内核。</p>
<p>用Eclipse可视化环境，单步调试Linux内核，参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/luteresa/article/details/119188792">https://blog.csdn.net/luteresa/article/details/119188792</a></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">一只不停游泳的鱼儿</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://luxihua.space/blog/1a3d20c9.html">http://luxihua.space/blog/1a3d20c9.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">一只不停游泳的鱼儿</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Linux/">
                                    <span class="chip bg-color">Linux</span>
                                </a>
                            
                                <a href="/tags/Qemu/">
                                    <span class="chip bg-color">Qemu</span>
                                </a>
                            
                                <a href="/tags/kernel/">
                                    <span class="chip bg-color">kernel</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 't7fHma85zB34TKeJjc64jsGe-gzGzoHsz',
        appKey: '5q4uaKjj8GE1wA3NxhVdl4f3',
        serverURLs: 'https://t7fhma85.lc-cn-n1-shared.com',
        notify: 'true' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'wavatar',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '如果你没有GitHub账号,还可以在这里评论啦!'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/blog/eef8a716.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/168.jpeg" class="responsive-img" alt="Linux内核自测">
                        
                        <span class="card-title">Linux内核自测</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-04-14
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Linux/" class="post-category">
                                    Linux
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                    <a href="/tags/Qemu/">
                        <span class="chip bg-color">Qemu</span>
                    </a>
                    
                    <a href="/tags/kernel/">
                        <span class="chip bg-color">kernel</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/blog/fa48b9ad.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/214.jpeg" class="responsive-img" alt="expect与shell自动化交互，实现批量自动化执行任务">
                        
                        <span class="card-title">expect与shell自动化交互，实现批量自动化执行任务</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-03-18
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Linux/" class="post-category">
                                    Linux
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                    <a href="/tags/expect/">
                        <span class="chip bg-color">expect</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('6'),
            headingSelector: 'h1, h2, h3, h4, h5, h6'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
    });
</script>



                <footer class="page-footer bg-color">
    

                <div class="container row center-align"
                    style="margin-bottom: 15px !important;">
                    <div class="col s12 m8 l8 copy-right">
                        Copyright&nbsp;&copy;
                        
                            <span id="year">2023-2024</span>
                            
                                    <a href="/about" target="_blank">一只不停游泳的鱼儿</a>
                                    |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
                                    |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery"
                                        target="_blank">Matery</a>
                                    
                                            <br>
                                            
                                                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">
                                                        193.6k
                                                    </span>
                                                    
                                                        
                                                            
                                                                
                                                                    
                                                                        
                                                                            <span id="busuanzi_container_site_pv">
                                                                                &nbsp;|&nbsp;<i
                                                                                    class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                                                                                    <span id="busuanzi_value_site_pv"
                                                                                        class="white-color"></span>
                                                                            </span>
                                                                            
                                                                                
                                                                                    <span
                                                                                        id="busuanzi_container_site_uv">
                                                                                        &nbsp;|&nbsp;<i
                                                                                            class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                                                                                            <span
                                                                                                id="busuanzi_value_site_uv"
                                                                                                class="white-color"></span>
                                                                                    </span>
                                                                                    
                                                                                        <br>

                                                                                        <!-- 运行天数提醒. -->
                                                                                        
                                                                                            <span id="sitetime"> Loading
                                                                                                ...</span>
                                                                                            <script>
                                                                                                var calcSiteTime = function () {
                                                                                                    var seconds = 1000;
                                                                                                    var minutes = seconds * 60;
                                                                                                    var hours = minutes * 60;
                                                                                                    var days = hours * 24;
                                                                                                    var years = days * 365;
                                                                                                    var today = new Date();
                                                                                                    var startYear = "2023";
                                                                                                    var startMonth = "2";
                                                                                                    var startDate = "21";
                                                                                                    var startHour = "0";
                                                                                                    var startMinute = "0";
                                                                                                    var startSecond = "0";
                                                                                                    var todayYear = today.getFullYear();
                                                                                                    var todayMonth = today.getMonth() + 1;
                                                                                                    var todayDate = today.getDate();
                                                                                                    var todayHour = today.getHours();
                                                                                                    var todayMinute = today.getMinutes();
                                                                                                    var todaySecond = today.getSeconds();
                                                                                                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                                                                                                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                                                                                                    var diff = t2 - t1;
                                                                                                    var diffYears = Math.floor(diff / years);
                                                                                                    var diffDays = Math.floor((diff / days) - diffYears * 365);

                                                                                                    // 区分是否有年份.
                                                                                                    var language = 'zh-CN';
                                                                                                    if (startYear === String(todayYear)) {
                                                                                                        document.getElementById("year").innerHTML = todayYear;
                                                                                                        var daysTip = 'This site has been running for ' + diffDays + ' days';
                                                                                                        if (language === 'zh-CN') {
                                                                                                            daysTip = '本站已运行 ' + diffDays + ' 天';
                                                                                                        } else if (language === 'zh-HK') {
                                                                                                            daysTip = '本站已運行 ' + diffDays + ' 天';
                                                                                                        }
                                                                                                        document.getElementById("sitetime").innerHTML = daysTip;
                                                                                                    } else {
                                                                                                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                                                                                                        var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                                                                                            + diffDays + ' days';
                                                                                                        if (language === 'zh-CN') {
                                                                                                            yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                                                                                                        } else if (language === 'zh-HK') {
                                                                                                            yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                                                                                                        }
                                                                                                        document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                                                                                                    }
                                                                                                }

                                                                                                calcSiteTime();
                                                                                            </script>
                                                                                            
                                                                                                <br>
                                                                                                
                    </div>
                    <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/lxh2010100" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1131729094@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://www.facebook.com/" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>



    <a href="https://twitter.com/" class="tooltipped" target="_blank" data-tooltip="关注我的Twitter: https://twitter.com/" data-position="top" data-delay="50">
        <i class="fab fa-twitter"></i>
    </a>







    <a href="https://www.zhihu.com/" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>


                    </div>
                </div>
</footer>

<div class="progress-bar"></div>

                    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

                        <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

                            <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


                                <script
                                    src="/libs/materialize/materialize.min.js"></script>
                                <script src="/libs/masonry/masonry.pkgd.min.js"></script>
                                <script src="/libs/aos/aos.js"></script>
                                <script
                                    src="/libs/scrollprogress/scrollProgress.min.js"></script>
                                <script
                                    src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
                                <script src="/js/matery.js"></script>

                                

                                        

                                                

                                                        <!-- 雪花特效 -->
                                                        
                                                            <script type="text/javascript">
                                                                // 只在桌面版网页启用特效
                                                                var windowWidth = $(window).width();
                                                                if (windowWidth > 768) {
                                                                    document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>');
                                                                }
                                                            </script>
                                                            

                                                                <!-- 鼠标星星特效 -->
                                                                

                                                                        
                                                                            <script
                                                                                src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
                                                                            <script
                                                                                src="/libs/others/TencentCaptcha.js"></script>
                                                                            <button id="TencentCaptcha"
                                                                                data-appid="xxxxxxxxxx"
                                                                                data-cbfn="callback" type="button"
                                                                                hidden></button>
                                                                            

                                                                                <!-- Baidu Analytics -->

                                                                                    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

                                                                                        
                                                                                                
                                                                                                    <script async
                                                                                                        src="/libs/others/busuanzi.pure.mini.js"></script>
                                                                                                    

                                                                                                        

                                                                                                                

                                                                                                                        <!--腾讯兔小巢-->
                                                                                                                        
                                                                                                                                
                                                                                                                                    <script
                                                                                                                                        type="text/javascript"
                                                                                                                                        color="0,0,255"
                                                                                                                                        pointColor="0,0,255"
                                                                                                                                        opacity='0.7'
                                                                                                                                        zIndex="-1"
                                                                                                                                        count="99"
                                                                                                                                        src="/libs/background/canvas-nest.js"></script>
                                                                                                                                    

                                                                                                                                        

                                                                                                                                                    
                                                                                                                                                        <script
                                                                                                                                                            type="text/javascript"
                                                                                                                                                            src="/libs/background/ribbon-dynamic.js"
                                                                                                                                                            async="async"></script>
                                                                                                                                                        

                                                                                                                                                            
                                                                                                                                                                <script
                                                                                                                                                                    src="/libs/instantpage/instantpage.js"
                                                                                                                                                                    type="module"></script>
                                                                                                                                                                

    <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body>

</html>